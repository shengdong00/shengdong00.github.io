<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>我国海水水质数据分析 | Sheng Dong&#39;s website</title>
<meta name="keywords" content="环境科学, 数据分析, 机器学习, 爬虫, Python">
<meta name="description" content="环境数据分析课程的大作业，主要目的应用一下课上学到的一些数据分析方法。

通过爬虫获取我国沿海海水水质的监测数据；
以散点图直观反映水质类别的分布和随时间变化情况；
将化学需氧量数据转换为正态分布，以海区/省份为分类变量进行单因素方差分析；
将无机氮数据转换为正态分布，用Pearson分析和线性回归分析考察化学需氧量和无机氮数据的相关性；
利用机器学习，从多个污染指标数据预测海区分类。

">
<meta name="author" content="Sʜᴇɴɢ Dong">
<link rel="canonical" href="https://dong2000.xyz/post/china_sea_water_data/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.79265b46f66f5bcf04b79589bf3d37013f67d61524773508f9719c7dded6d367.css" integrity="sha256-eSZbRvZvW88Et5WJvz03AT9n1hUkdzUI&#43;XGcfd7W02c=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.4eed01e448f4569cb57e66d5e3d64b94bf981f8fab7d65ef40caf09fc438ace6.js" integrity="sha256-Tu0B5Ej0Vpy1fmbV49ZLlL&#43;YH4&#43;rfWXvQMrwn8Q4rOY="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dong2000.xyz/ptr.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://dong2000.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dong2000.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dong2000.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://dong2000.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://dong2000.xyz/post/china_sea_water_data/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MT6FEG7LK4"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-MT6FEG7LK4', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="我国海水水质数据分析" />
<meta property="og:description" content="环境数据分析课程的大作业，主要目的应用一下课上学到的一些数据分析方法。

通过爬虫获取我国沿海海水水质的监测数据；
以散点图直观反映水质类别的分布和随时间变化情况；
将化学需氧量数据转换为正态分布，以海区/省份为分类变量进行单因素方差分析；
将无机氮数据转换为正态分布，用Pearson分析和线性回归分析考察化学需氧量和无机氮数据的相关性；
利用机器学习，从多个污染指标数据预测海区分类。

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dong2000.xyz/post/china_sea_water_data/" /><meta property="og:image" content="https://dong2000.xyz/ptr.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-24T01:36:16+00:00" />
<meta property="article:modified_time" content="2022-04-24T01:36:16+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dong2000.xyz/ptr.png"/>

<meta name="twitter:title" content="我国海水水质数据分析"/>
<meta name="twitter:description" content="环境数据分析课程的大作业，主要目的应用一下课上学到的一些数据分析方法。

通过爬虫获取我国沿海海水水质的监测数据；
以散点图直观反映水质类别的分布和随时间变化情况；
将化学需氧量数据转换为正态分布，以海区/省份为分类变量进行单因素方差分析；
将无机氮数据转换为正态分布，用Pearson分析和线性回归分析考察化学需氧量和无机氮数据的相关性；
利用机器学习，从多个污染指标数据预测海区分类。

"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://dong2000.xyz/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "我国海水水质数据分析",
      "item": "https://dong2000.xyz/post/china_sea_water_data/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "我国海水水质数据分析",
  "name": "我国海水水质数据分析",
  "description": "环境数据分析课程的大作业，主要目的应用一下课上学到的一些数据分析方法。\n通过爬虫获取我国沿海海水水质的监测数据； 以散点图直观反映水质类别的分布和随时间变化情况； 将化学需氧量数据转换为正态分布，以海区/省份为分类变量进行单因素方差分析； 将无机氮数据转换为正态分布，用Pearson分析和线性回归分析考察化学需氧量和无机氮数据的相关性； 利用机器学习，从多个污染指标数据预测海区分类。 ",
  "keywords": [
    "环境科学", "数据分析", "机器学习", "爬虫", "Python"
  ],
  "articleBody": "环境数据分析课程的大作业，主要目的应用一下课上学到的一些数据分析方法。\n通过爬虫获取我国沿海海水水质的监测数据； 以散点图直观反映水质类别的分布和随时间变化情况； 将化学需氧量数据转换为正态分布，以海区/省份为分类变量进行单因素方差分析； 将无机氮数据转换为正态分布，用Pearson分析和线性回归分析考察化学需氧量和无机氮数据的相关性； 利用机器学习，从多个污染指标数据预测海区分类。 数据获取 爬虫 来源：生态环境部的海水水质监测信息公开系统。网址：http://ep.nmemc.org.cn:8888/Water/\n1 2 3 4 5 from selenium import webdriver import pandas as pd wd = webdriver.Chrome() wd.get('http://ep.nmemc.org.cn:8888/Water/') 对动态网页的表格设置过滤属性。这里先筛选获取2020年的数据。\n1 2 3 4 5 6 7 8 9 10 11 12 year = wd.find_element_by_id('ddl_year') sea = wd.find_element_by_id('ddl_sea') province = wd.find_element_by_id('ddl_province') city = wd.find_element_by_id('ddl_city') year.send_keys('2020') sea.send_keys('全部') province.send_keys('全部') city.send_keys('全部') botton = wd.find_element_by_id('btn') botton.click() 获取表头和数据，并整理成二维数组的类型。\n1 2 3 4 5 6 7 8 9 10 11 header = wd.find_element_by_id('gridHd') heads = header.text.replace('\\n','').split(' ') body = wd.find_element_by_id('gridDatas') predatas = body.text.split('\\n') total = int(len(predatas)/2) data = [] for i in range(total): row = predatas[2*i].split(' ') row.append(predatas[2*i+1]) data.append(row) 把2021年的数据也添加到数组里，转换成data frame。\n1 2 3 4 5 6 7 8 9 10 11 12 year.send_keys('2021') botton.click() body = wd.find_element_by_id('gridDatas') predatas = body.text.split('\\n') total = int(len(predatas)/2) for i in range(total): row = predatas[2*i].split(' ') row.append(predatas[2*i+1]) data.append(row) df = pd.DataFrame(data, columns=heads) 数据整理和保存 发现部分监测点数据位移，原因是部分监测点的溶解氧数据缺失，还有一些数据点的溶解氧和石油类数据都缺失。对这些监测点的信息进行修正，缺失的地方用None标记。\n1 2 3 4 5 6 7 8 9 for i in range(len(df)): if df['水质类别'][i]==None: for j in range(13,8,-1): df.iloc[i,j] = df.iloc[i,j-1] df.iloc[i,8] = None for i in range(len(df)): if df['水质类别'][i]==None: df.iloc[i,13] = df.iloc[i,12] df.iloc[i,12] = None 保存数据到本地。此时数据全都以字符串保存。缺失值标记为“None”，低于检出限的数据标记为“未检出”，或根据检出限的值标记为“\u003c0.01”或“\u003c0.1”。\n1 2 wd.quit() df.to_pickle('./Data.pkl') 水质类别动态变化 根据每个月水质监测数据的经纬度信息和水质类别作图。\n1 2 3 4 5 import pandas as pd import matplotlib.pyplot as plt from matplotlib.pyplot import MultipleLocator data = pd.read_pickle('./Data.pkl') 查看一下水质类别有哪些分类，执行data['水质类别'].value_counts()，输出：\n1 2 3 4 5 6 一类 4082 二类 1343 劣四类 1154 三类 514 四类 476 Name: 水质类别, dtype: int64 将经纬度数据转换成浮点型。\n1 2 data['实测经度'] = pd.to_numeric(data['实测经度']) data['实测纬度'] = pd.to_numeric(data['实测纬度']) 定义返回某年某月所有监测点坐标的函数。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 def getlongitude(dataframe,year,month): longitude_by_level = [] a = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='一类')]['实测经度'] b = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='二类')]['实测经度'] c = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='三类')]['实测经度'] d = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='四类')]['实测经度'] e = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='劣四类')]['实测经度'] longitude_by_level.append(a) longitude_by_level.append(b) longitude_by_level.append(c) longitude_by_level.append(d) longitude_by_level.append(e) return longitude_by_level def getlatitude(dataframe,year,month): latitude_by_level = [] a = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='一类')]['实测纬度'] b = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='二类')]['实测纬度'] c = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='三类')]['实测纬度'] d = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='四类')]['实测纬度'] e = dataframe[(dataframe['监测时间']==year+'-'+month)\u0026(dataframe['水质类别']=='劣四类')]['实测纬度'] latitude_by_level.append(a) latitude_by_level.append(b) latitude_by_level.append(c) latitude_by_level.append(d) latitude_by_level.append(e) return latitude_by_level 定义画出某年某月水质类别分布图的函数。将网上找的我国海岸线轮廓作为底图（网上下载下来是shp格式的，但是找到了一个很好的网站，可以将shp图层文件转换成位图 https://mapshaper.org/）。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 def draw_plot(year,month,longitude_by_level,latitude_by_level): fig, ax = plt.subplots(figsize=((128-106),(42-14))) ax.scatter(longitude_by_level[0], latitude_by_level[0], c='paleturquoise', s=100, EdgeColor='k') ax.scatter(longitude_by_level[1], latitude_by_level[1], c='c', s=100, EdgeColor='k') ax.scatter(longitude_by_level[2], latitude_by_level[2], c='cadetblue', s=100, EdgeColor='k') ax.scatter(longitude_by_level[3], latitude_by_level[3], c='teal', s=100, EdgeColor='k') ax.scatter(longitude_by_level[4], latitude_by_level[4], c='darkslategrey', s=100, EdgeColor='k') plt.rcParams['font.sans-serif']=['SimHei']###解决中文乱码 plt.rcParams['axes.unicode_minus']=False ax.legend(['一类','二类','三类','四类','劣四类'],fontsize=30,loc='upper left') ax.axis([106,128,14,42]) major_locator=MultipleLocator(5) ax.xaxis.set_major_locator(major_locator) ax.grid() plt.xticks(fontsize=30) plt.yticks(fontsize=30) plt.xlabel('经度(E°)',fontsize=30) plt.ylabel('纬度(N°)',fontsize=30) plt.title(str(year)+'年'+str(month)+'月我国沿海监测点水质类别情况',fontsize=40) img = plt.imread(\"land-sea.jpg\") zoom = 0.0221 height,width = len(img)*zoom,len(img[0])*zoom x,y = 121.0,22.1 ax.imshow(img,extent=[x-width/2,x+width/2,y-height/2,y+height/2]) plt.savefig('../沿海检测点水质类别变化/'+year+'-'+month+'.jpg', dpi=200) 生成2020-2021年每月的水质分布图。\n1 2 3 4 5 6 for year in ['2020','2021']: for month in ['01','02','03','04','05','06','07','08','09','10','11','12']: print('Drawing '+year+'-'+month) longitude_by_level = getlongitude(data,year,month) latitude_by_level = getlatitude(data,year,month) draw_plot(year,month,longitude_by_level,latitude_by_level) 将图片拼接成GIF动图。\n1 2 3 4 5 6 import imageio, os, sys jpg_lst = os.listdir('../沿海检测点水质类别变化/') frames = [] for img in jpg_lst: frames.append(imageio.imread('../沿海检测点水质类别变化/' + img)) imageio.mimsave(\"../沿海检测点水质类别变化/result.gif\", frames, 'GIF', duration=0.5) 简单数据分析：正态性检验、方差分析、Pearson分析和线性回归 以“化学需氧量(mg/L)”为研究数据，考察不同海区/省份之间的海水COD差异性。首先将数据转换为数值类型，标记为“未检出”的数据记为0。由于方差分析适用于正态分布的样本，因此先对数据进行分布检验，变换为接近正态分布的形式后再进行方差分析。\n1 2 3 4 5 6 7 8 9 10 11 import pandas as pd import matplotlib.pyplot as plt from scipy import stats import numpy as np import random import seaborn as sns from statsmodels.formula.api import ols from statsmodels.stats.anova import anova_lm from sklearn.linear_model import LinearRegression plt.rcParams['font.sans-serif']=['SimHei']###解决中文乱码 plt.rcParams['axes.unicode_minus']=False 数据清理和转换 首先读取数据，转换成浮点型。\n1 2 3 4 5 data = pd.read_pickle('./Data.pkl') for i in cod.index: if cod[i] == '未检出': cod[i] = '0' cod = pd.to_numeric(cod) 从原始数据的直方图大致看一下分布情况。\n1 2 3 4 5 fig, ax = plt.subplots(figsize=(15,5)) sns.histplot(cod, bins=150) plt.xlim(min(cod), max(cod)) plt.xlabel('COD(mg/L)') plt.ylabel('Frequency') 可以看出样本是明显有偏的，计算样本的偏度（Skewness）和峰度（Kurtosis）。\n1 2 3 s = cod.skew() k = cod.kurt() print('偏度 = '+str(s)+', 峰度 = '+str(k)) 1 偏度 = 4.58614227400281, 峰度 = 43.47585104239013 偏度$S\u003e0$，表明样本正偏，数据出现右侧长尾；峰度$K\u003e6$，表明分布陡峭。尝试通过取对数得到接近正态的分布。这里考虑到0的数据比较多，若采用$x’=\\lg(x+10^{-n})$的转换方法，会在$x=-n$的地方出现一个异常峰，所以决定舍弃0数据。\n1 2 3 4 5 6 cod2 = pd.Series.copy(cod,deep=True) for i in cod2.index: if cod[i] == 0: del cod2[i] else: cod2[i] = np.log10(cod[i]) 1 2 3 4 5 fig, ax = plt.subplots(figsize=(7,5)) sns.histplot(cod2, bins=100) plt.xlim(min(cod2), max(cod2)) plt.xlabel('log10(COD)') plt.ylabel('Frequency') 1 2 3 s = cod2.skew() k = cod2.kurt() print('偏度 = '+str(s)+', 峰度 = '+str(k)) 1 偏度 = 0.08821022006460341, 峰度 = 0.6118708597667646 转换后的样本偏度约等于零，可以近似认为样本是无偏的。考虑到样本量\u003e7500，根据大数定理认为样本总体符合正态分布。\n事实上如果用K-S检验，还是会发现不能通过正态性检验的。可能是因为数据的差异性大，所以样本数量还远远不够；也有可能是因为数据本身的采样有偏，事实上水质监测数据确实不是完全随机时刻和取点的，会受到采样点设置偏好的影响。这里只是凭借大数定理和Q-Q图，定性地认为服从正态分布。\n用Q-Q图辅助判断，处理后的数据点更好地分布在对角线上。\n1 2 3 4 5 fig, ax = plt.subplots(1,2,figsize=(12,5)) stats.probplot(cod, dist=\"norm\", plot=ax[0]) stats.probplot(cod2, dist=\"norm\", plot=ax[1]) ax[0].set_title('Original Data') ax[1].set_title('Logarithmic Data') 方差分析 获取海区和省份的数据（定类数据），和对数化的COD一起合成data frame。\n1 2 3 4 5 anova_data = pd.DataFrame(columns=['海区','省份','logCOD']) for i in cod2.index: sea = data['海区'][i] province = data['省份'][i] anova_data.loc[i] = [sea, province, cod2[i]] 先用箱型图看一下四大海区的分布差异。\n1 2 fig, ax = plt.subplots(figsize=(7,5)) sns.boxplot(x='海区',y='logCOD',data = anova_data) 单因素方差分析。\n1 2 3 model = ols('logCOD ~ 海区',data=anova_data).fit() anova_table = anova_lm(model, typ = 2) print(anova_table) 1 2 3 sum_sq df F PR(\u003eF) 海区 73.816704 3.0 390.048152 1.941560e-235 Residual 473.062501 7499.0 NaN NaN 省份分布差异同理。\n1 2 fig, ax = plt.subplots(figsize=(10,5)) sns.boxplot(x='省份',y='logCOD',data = anova_data) 1 2 3 model = ols('logCOD ~ 省份',data=anova_data).fit() anova_table = anova_lm(model, typ = 2) print(anova_table) 1 2 3 sum_sq df F PR(\u003eF) 省份 102.311302 11.0 156.722959 0.0 Residual 444.567902 7491.0 NaN NaN 单因素方差分析P值均低于0.01，表明海区和省份因素都会使得COD数据产生显著差异。\nPearson相关分析 上面的分析是针对COD（定序变量）和海区/省份（定类变量）之间关系的分析。接下来选取“无机氮(mg/L)”数据，与COD数据进行定序变量的相关性分析。由于Pearson相关性分析要求两个变量均服从正态分布，因此对无机氮数据也要先进行数据清理和转换，取以10为底的对数。Q-Q图依然可以反映出处理前后的正态性变化。\n1 2 3 4 5 ni = data['无机氮(mg/L)'] ni = pd.to_numeric(ni) ni2 = ni.copy(deep=True) for i in ni.index: ni2[i] = np.log10(np.sqrt(ni[i])) 1 2 3 4 5 fig, ax = plt.subplots(1,2,figsize=(12,5)) stats.probplot(ni, dist=\"norm\", plot=ax[0]) stats.probplot(ni2, dist=\"norm\", plot=ax[1]) ax[0].set_title('Original Data') ax[1].set_title('Logarithmic Data') 由于有些监测点只有化学需氧量数据，没有无机氮数据，因此需要进行数据清理，将这些监测点删除。\n1 2 3 for i in range(len(data)): if i not in cod2.index: del ni2[i] 进行Pearson检验。\n1 2 r,p = stats.pearsonr(ni2,cod2) print('Pearson检验，相关系数 = %f, P值 = %f'%(r,p)) 1 Pearson检验，相关系数 = 0.446809, P值 = 0.000000 $r\\in(0.4,0.6)$，认为$\\lg(\\rm COD)$和$\\lg(\\rm N)$之间为中等程度正相关。通过散点图分布情况也可以感性判断出这一规律。\n线性回归 1 2 3 4 5 6 7 model = LinearRegression() model.fit(ni.values.reshape((-1, 1)), cod.values) predict_y = model.predict(ni2.values.reshape((-1, 1))) print('线性回归斜率：',model.coef_, '\\n截距：',model.intercept_, '\\nR方：',model.score(ni.values.reshape((-1, 1)),cod.values)) 1 2 3 线性回归斜率： [1.10361078] 截距： 0.7039567080504857 R方： 0.24820547860780384 1 2 3 4 5 fig, ax = plt.subplots(figsize=(5,5)) plt.scatter(ni2,cod2,s=1) plt.plot(ni2,predict_y,c='k') plt.xlabel('logN') plt.ylabel('logCOD') 考虑到海水地理位置对相关性的影响，再分海区绘制散点图和回归曲线。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 sl_data = pd.DataFrame(columns=['海区','logN','logCOD']) for i in cod2.index: sea = data['海区'][i] sl_data.loc[i] = [sea, ni2[i], cod2[i]] seas = ['黄海','渤海','东海','南海'] predicts = [] for i in range(4): model = LinearRegression() model.fit(sl_data[sl_data['海区']==seas[i]]['logN'].values.reshape((-1, 1)), sl_data[sl_data['海区']==seas[i]]['logCOD'].values) predict_y = model.predict(sl_data[sl_data['海区']==seas[i]]['logN'].values.reshape((-1, 1))) predicts.append(predict_y) print(seas[i], '\\n线性回归斜率：',model.coef_, '\\n截距：',model.intercept_, '\\nR方：',model.score(sl_data[sl_data['海区']==seas[i]]['logN'].values.reshape((-1, 1)), sl_data[sl_data['海区']==seas[i]]['logCOD'].values) ) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 黄海 线性回归斜率： [0.26539399] 截距： 0.081372330354296 R方： 0.14307643170710227 渤海 线性回归斜率： [0.27080498] 截距： 0.20731753294507865 R方： 0.1352474744941149 东海 线性回归斜率： [0.63405663] 截距： 0.0898058817788494 R方： 0.3550328969220925 南海 线性回归斜率： [0.36912331] 截距： 0.012211050912901922 R方： 0.1838150602146984 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 fig, ax = plt.subplots(2,2,figsize=(10,10)) ax[0,0].scatter(sl_data[sl_data['海区']=='黄海']['logN'], sl_data[sl_data['海区']=='黄海']['logCOD'], s=3, c='g') ax[0,0].plot(sl_data[sl_data['海区']=='黄海']['logN'], predicts[0], c='k') ax[0,0].set_title('黄 海') ax[0,0].set_xlabel('logN') ax[0,0].set_ylabel('logCOD') ax[0,0].set_xlim(-1.52, 0.5) ax[0,0].set_ylim(-1.2,1.3) ax[0,1].scatter(sl_data[sl_data['海区']=='渤海']['logN'], sl_data[sl_data['海区']=='渤海']['logCOD'], s=3, c='y') ax[0,1].plot(sl_data[sl_data['海区']=='渤海']['logN'], predicts[1], c='k') ax[0,1].set_title('渤 海') ax[0,1].set_xlabel('logN') ax[0,1].set_ylabel('logCOD') ax[0,1].set_xlim(-1.52, 0.5) ax[0,1].set_ylim(-1.2,1.3) ax[1,0].scatter(sl_data[sl_data['海区']=='东海']['logN'], sl_data[sl_data['海区']=='东海']['logCOD'], s=3, c='purple') ax[1,0].plot(sl_data[sl_data['海区']=='东海']['logN'], predicts[2], c='k') ax[1,0].set_title('东 海') ax[1,0].set_xlabel('logN') ax[1,0].set_ylabel('logCOD') ax[1,0].set_xlim(-1.52, 0.5) ax[1,0].set_ylim(-1.2,1.3) ax[1,1].scatter(sl_data[sl_data['海区']=='南海']['logN'], sl_data[sl_data['海区']=='南海']['logCOD'], s=3, c='brown') ax[1,1].plot(sl_data[sl_data['海区']=='南海']['logN'], predicts[3], c='k') ax[1,1].set_title('南 海') ax[1,1].set_xlabel('logN') ax[1,1].set_ylabel('logCOD') ax[1,1].set_xlim(-1.52, 0.5) ax[1,1].set_ylim(-1.2,1.3) 机器学习 为了从多个污染指标的层面上对不同海区的差异进行分析，以“化学需氧量(mg/L)”、“无机氮(mg/L)”、“活性磷酸盐(mg/L)”、“石油类(mg/L)”这四个指标作为自变量，将“海区”作为因变量，尝试用5种不同的模型进行机器学习，并找出预测准确度最高的模型进行进一步分析。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import pandas as pd import matplotlib.pyplot as plt import numpy as np import seaborn as sns plt.rcParams['font.sans-serif']=['SimHei']###解决中文乱码 plt.rcParams['axes.unicode_minus']=False from sklearn import model_selection from sklearn.preprocessing import StandardScaler from sklearn.tree import DecisionTreeClassifier from sklearn.neighbors import KNeighborsClassifier from sklearn.linear_model import LogisticRegression from sklearn.svm import SVC from sklearn.ensemble import RandomForestClassifier from sklearn.model_selection import cross_val_score from sklearn.metrics import classification_report, confusion_matrix, f1_score, roc_curve, roc_auc_score, precision_score, accuracy_score, recall_score, explained_variance_score, mean_absolute_error, mean_squared_error, r2_score 数据清理 首先把数据转换为数值类型。将标记为“未检出”、“\u003c0.01”、“\u003c0.1”的数据转换为0。将因变量（海区）数值化，标记成0~3。\n海区 数值化 黄海 0 渤海 1 东海 2 南海 3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 for i in range(len(data)): if data['海区'][i]=='黄海': data['海区'][i] = 0 elif data['海区'][i]=='渤海': data['海区'][i] = 1 elif data['海区'][i]=='东海': data['海区'][i] = 2 else: data['海区'][i] = 3 for item in ['化学需氧量(mg/L)','无机氮(mg/L)','活性磷酸盐(mg/L)','石油类(mg/L)']: if type(data[item][i])==str and (data[item][i] == '未检出' or data[item][i][0] == '\u003c'): data[item][i] = '0' D = data.loc[:,['海区','化学需氧量(mg/L)','无机氮(mg/L)','活性磷酸盐(mg/L)','石油类(mg/L)']] for item in D.columns: D[item] = pd.to_numeric(D[item]) 其中任何一项数据缺失的监测点都删除，最后把清理后的因变量保存为一维数组Y，自变量保存为四维数组X。\n1 2 3 4 5 6 nanlist = [] for i in range(len(D.values)): if True in np.isnan(D.values[i]): nanlist.append(i) X = np.delete(D.iloc[:,1:5].values, nanlist, axis=0) Y = np.delete(D.iloc[:,0].values, nanlist, axis=0) 多模型比较 划分训练集和测试机，特征缩放。\n1 2 3 4 x_train,x_test, y_train,y_test = model_selection.train_test_split(X, Y, test_size=0.2, random_state=1) sc = StandardScaler() x_train = sc.fit_transform(x_train) x_test = sc.transform(x_test) 用于对比的5种模型分别是：Decision Tree决策树、K-Nearest Neighbors K-最近邻（KNN）、Logistic Regression 逻辑回归、SVM支持向量机 (SVM)、Random Forest Tree随机森林。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # 1. Decision Tree 决策树 tree_model = DecisionTreeClassifier(max_depth = 10, criterion = 'entropy') tree_model.fit(x_train, y_train) tree_yhat = tree_model.predict(x_test) # 2. K-Nearest Neighbors K-最近邻 (KNN) n = 20 knn = KNeighborsClassifier(n_neighbors = n) knn.fit(x_train, y_train) knn_yhat = knn.predict(x_test) # 3. Logistic Regression 逻辑回归 lr = LogisticRegression() lr.fit(x_train, y_train) lr_yhat = lr.predict(x_test) # 4. SVM 支持向量机 (SVM) svm = SVC(probability=True) #SVM要制作ROC曲线，必须probability=True，默认值False svm.fit(x_train, y_train) svm_yhat = svm.predict(x_test) # 5. Random Forest Tree 随机森林 rf = RandomForestClassifier(max_depth = 10) rf.fit(x_train, y_train) rf_yhat = rf.predict(x_test) 分别用accuracy score和F1-score来衡量不同模型的效果。\n1 2 3 4 5 6 7 8 9 10 11 12 pd.DataFrame({ 'Model': ['Decision Tree model', 'KNN model', 'Logistic Regression model', 'SVM model', 'Random Forest Tree model'], 'Accuracy score':[accuracy_score(y_test, tree_yhat), accuracy_score(y_test, knn_yhat), accuracy_score(y_test, lr_yhat), accuracy_score(y_test, svm_yhat), accuracy_score(y_test, rf_yhat)] }) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 pd.DataFrame({ 'Model': ['Decision Tree model', 'KNN model', 'Logistic Regression model', 'SVM model', 'Random Forest Tree model'], '黄海(0)':[f1_score(y_test, tree_yhat, average=None)[0], f1_score(y_test, knn_yhat, average=None)[0], f1_score(y_test, lr_yhat, average=None)[0], f1_score(y_test, svm_yhat,average=None)[0], f1_score(y_test, rf_yhat, average=None)[0]], '渤海(1)': [f1_score(y_test, tree_yhat, average=None)[1], f1_score(y_test, knn_yhat, average=None)[1], f1_score(y_test, lr_yhat, average=None)[1], f1_score(y_test, svm_yhat,average=None)[1], f1_score(y_test, rf_yhat, average=None)[1]], '东海(2)':[f1_score(y_test, tree_yhat, average=None)[2], f1_score(y_test, knn_yhat, average=None)[2], f1_score(y_test, lr_yhat, average=None)[2], f1_score(y_test, svm_yhat,average=None)[2], f1_score(y_test, rf_yhat, average=None)[2]], '南海(3)': [f1_score(y_test, tree_yhat, average=None)[3], f1_score(y_test, knn_yhat, average=None)[3], f1_score(y_test, lr_yhat, average=None)[3], f1_score(y_test, svm_yhat,average=None)[3], f1_score(y_test, rf_yhat, average=None)[3]], }) 通过混淆矩阵也可以判断不同模型的预测能力，并且比较不同海区的数据被正确判断或误判为其他海区的可能性。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 tree_matrix = confusion_matrix(y_test, tree_yhat, labels = [0, 1, 2, 3]) # Decision Tree knn_matrix = confusion_matrix(y_test, knn_yhat, labels = [0, 1, 2, 3]) # K-Nearest Neighbors lr_matrix = confusion_matrix(y_test, lr_yhat, labels = [0, 1, 2, 3]) # Logistic Regression svm_matrix = confusion_matrix(y_test, svm_yhat, labels = [0, 1, 2, 3]) # Support Vector Machine rf_matrix = confusion_matrix(y_test, rf_yhat, labels = [0, 1, 2, 3]) # Random Forest Tree def plot_confusion_matrix(ax, cm, classes, title): plot = ax.imshow(cm, interpolation='nearest', cmap=plt.cm.Blues) ax.set_title(title) ax.set_xticks([0,1,2,3]) ax.set_xticklabels(classes) ax.set_yticks([0,1,2,3]) ax.set_yticklabels(classes) ax.set_ylabel('真实海区') ax.set_xlabel('预测海区') return plot classes = ['黄海(0)','渤海(1)','东海(2)','南海(3)'] fig, ax = plt.subplots(2,3,figsize=(16,8)) a = plot_confusion_matrix(ax[0][0], tree_matrix, classes=classes, title='Decision Tree') b = plot_confusion_matrix(ax[0][1], knn_matrix, classes=classes, title='KNN') c = plot_confusion_matrix(ax[0][2], lr_matrix, classes=classes, title='Logistic Regression') d = plot_confusion_matrix(ax[1][0], svm_matrix, classes=classes, title='SVM') e = plot_confusion_matrix(ax[1][1], rf_matrix, classes=classes, title='Random Forest Tree') fig.colorbar(a, ax = ax[0][0]) fig.colorbar(b, ax = ax[0][1]) fig.colorbar(c, ax = ax[0][2]) fig.colorbar(d, ax = ax[1][0]) fig.colorbar(e, ax = ax[1][1]) fig.delaxes(ax[1][2]) plt.tight_layout() plt.show() KNN模型 综合以上，认为在当前的参数设置下KNN模型具有最好的解释力。输出KNN模型的分类报告。\n1 print(classification_report(y_test, knn_yhat)) 1 2 3 4 5 6 7 8 9 10 precision recall f1-score support 0 0.52 0.62 0.57 370 1 0.56 0.61 0.59 295 2 0.71 0.70 0.70 446 3 0.59 0.46 0.52 398 accuracy 0.60 1509 macro avg 0.60 0.60 0.59 1509 weighted avg 0.60 0.60 0.60 1509 本模型采用的是多分类模型，但是传统的ROC曲线和AUC只能用于描述不同于“0-1”分类模型。首先需要将因变量的测试集转换成类似于0-1分类的多维矩阵。\n1 2 y_test0 = np.array([[ 1 if y_test[i]==j else 0 for j in range(4) ] for i in range(len(y_test))], dtype=float) y_test0 1 2 3 4 5 6 7 array([[0., 0., 1., 0.], [0., 0., 1., 0.], [0., 1., 0., 0.], ..., [1., 0., 0., 0.], [0., 1., 0., 0.], [0., 0., 1., 0.]]) 将转换后的因变量测试集和自变量测试集都按行展开，例如\n1 y_test0.ravel() 1 array([0., 0., 1., ..., 0., 1., 0.]) 采用macro方法对多分类数据进行处理，然后再计算ROC曲线和AUC值。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 y_pred=knn.predict_proba(x_test)[:,:] roc_score = roc_auc_score(y_test, y_pred, multi_class='ovo', average='macro') y_test0 = np.array([[ 1 if y_test[i]==j else 0 for j in range(4) ] for i in range(len(y_test))], dtype=float) fpr,tpr, thresholds = roc_curve(y_test0.ravel(), y_pred.ravel(), pos_label=True) fig, ax = plt.subplots(1,1,figsize=(8,6)) ax.plot(fpr,tpr,\"r\",linewidth = 3) ax.set_title(\"多分类ROC曲线\") ax.plot([0, 1], [0, 1], 'k--') ax.grid() ax.set_xlabel(\"假正率\") ax.set_ylabel(\"真正率\") ax.set_xlim(0, 1) ax.set_ylim(0, 1) ax.text(0.15,0.9,\"AUC = \"+str(round(roc_score,4))) plt.show() 限制本模型预测能力的可能原因有：分类精细度和依据不合适；没有找到最关键的自变量；数据采集有偏；模型训练迭代次数不足。\n",
  "wordCount" : "1948",
  "inLanguage": "en",
  "datePublished": "2022-04-24T01:36:16Z",
  "dateModified": "2022-04-24T01:36:16Z",
  "author":{
    "@type": "Person",
    "name": "Sʜᴇɴɢ Dong"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dong2000.xyz/post/china_sea_water_data/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sheng Dong's website",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dong2000.xyz/ptr.png"
    }
  }
}
</script>




</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dong2000.xyz/" accesskey="h" title="波忒利 (Alt + H)" style="font-size:1.2em;">
                <img src="https://dong2000.xyz/ptr.png" alt="" aria-label="logo"
                    height="40">波忒利</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://dong2000.xyz/profile/" title="Profile"
                            aria-label="Profile">Profile</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://dong2000.xyz/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://dong2000.xyz/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://dong2000.xyz/links/" title="Links">
                    <span>Links</span>
                </a>
            </li>
            <li>
                <a href="https://dong2000.xyz/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header><main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://dong2000.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://dong2000.xyz/post/">Posts</a></div>
    <h1 class="post-title">
      我国海水水质数据分析
    </h1>
    <div class="post-meta">

<span title='2022-04-24 01:36:16 +0000 UTC'>April 24, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Sʜᴇɴɢ Dong&nbsp;·&nbsp;

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details >
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e6%95%b0%e6%8d%ae%e8%8e%b7%e5%8f%96" aria-label="数据获取">数据获取</a><ul>
                            
                    <li>
                        <a href="#%e7%88%ac%e8%99%ab" aria-label="爬虫">爬虫</a></li>
                    <li>
                        <a href="#%e6%95%b0%e6%8d%ae%e6%95%b4%e7%90%86%e5%92%8c%e4%bf%9d%e5%ad%98" aria-label="数据整理和保存">数据整理和保存</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%b0%b4%e8%b4%a8%e7%b1%bb%e5%88%ab%e5%8a%a8%e6%80%81%e5%8f%98%e5%8c%96" aria-label="水质类别动态变化">水质类别动态变化</a></li>
                    <li>
                        <a href="#%e7%ae%80%e5%8d%95%e6%95%b0%e6%8d%ae%e5%88%86%e6%9e%90%e6%ad%a3%e6%80%81%e6%80%a7%e6%a3%80%e9%aa%8c%e6%96%b9%e5%b7%ae%e5%88%86%e6%9e%90pearson%e5%88%86%e6%9e%90%e5%92%8c%e7%ba%bf%e6%80%a7%e5%9b%9e%e5%bd%92" aria-label="简单数据分析：正态性检验、方差分析、Pearson分析和线性回归">简单数据分析：正态性检验、方差分析、Pearson分析和线性回归</a><ul>
                            
                    <li>
                        <a href="#%e6%95%b0%e6%8d%ae%e6%b8%85%e7%90%86%e5%92%8c%e8%bd%ac%e6%8d%a2" aria-label="数据清理和转换">数据清理和转换</a></li>
                    <li>
                        <a href="#%e6%96%b9%e5%b7%ae%e5%88%86%e6%9e%90" aria-label="方差分析">方差分析</a></li>
                    <li>
                        <a href="#pearson%e7%9b%b8%e5%85%b3%e5%88%86%e6%9e%90" aria-label="Pearson相关分析">Pearson相关分析</a></li>
                    <li>
                        <a href="#%e7%ba%bf%e6%80%a7%e5%9b%9e%e5%bd%92" aria-label="线性回归">线性回归</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0" aria-label="机器学习">机器学习</a><ul>
                            
                    <li>
                        <a href="#%e6%95%b0%e6%8d%ae%e6%b8%85%e7%90%86" aria-label="数据清理">数据清理</a></li>
                    <li>
                        <a href="#%e5%a4%9a%e6%a8%a1%e5%9e%8b%e6%af%94%e8%be%83" aria-label="多模型比较">多模型比较</a></li>
                    <li>
                        <a href="#knn%e6%a8%a1%e5%9e%8b" aria-label="KNN模型">KNN模型</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><p>环境数据分析课程的大作业，主要目的应用一下课上学到的一些数据分析方法。</p>
<ol>
<li>通过爬虫获取我国沿海海水水质的监测数据；</li>
<li>以散点图直观反映水质类别的分布和随时间变化情况；</li>
<li>将化学需氧量数据转换为正态分布，以海区/省份为分类变量进行单因素方差分析；</li>
<li>将无机氮数据转换为正态分布，用Pearson分析和线性回归分析考察化学需氧量和无机氮数据的相关性；</li>
<li>利用机器学习，从多个污染指标数据预测海区分类。</li>
</ol>
<img src="/images/image-20220424023106157.png" alt="image-20220424023106157" style="zoom:25%;" />   
<h1 id="数据获取">数据获取<a hidden class="anchor" aria-hidden="true" href="#数据获取">#</a></h1>
<h2 id="爬虫">爬虫<a hidden class="anchor" aria-hidden="true" href="#爬虫">#</a></h2>
<p>来源：生态环境部的海水水质监测信息公开系统。网址：http://ep.nmemc.org.cn:8888/Water/</p>
<p><img loading="lazy" src="/images/image-20220424020835110.png" alt="image-20220424020835110"  />
</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1">1</a>
</span><span class="lnt" id="hl-0-2"><a class="lnlinks" href="#hl-0-2">2</a>
</span><span class="lnt" id="hl-0-3"><a class="lnlinks" href="#hl-0-3">3</a>
</span><span class="lnt" id="hl-0-4"><a class="lnlinks" href="#hl-0-4">4</a>
</span><span class="lnt" id="hl-0-5"><a class="lnlinks" href="#hl-0-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">wd</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">wd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://ep.nmemc.org.cn:8888/Water/&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>对动态网页的表格设置过滤属性。这里先筛选获取2020年的数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a class="lnlinks" href="#hl-1-1"> 1</a>
</span><span class="lnt" id="hl-1-2"><a class="lnlinks" href="#hl-1-2"> 2</a>
</span><span class="lnt" id="hl-1-3"><a class="lnlinks" href="#hl-1-3"> 3</a>
</span><span class="lnt" id="hl-1-4"><a class="lnlinks" href="#hl-1-4"> 4</a>
</span><span class="lnt" id="hl-1-5"><a class="lnlinks" href="#hl-1-5"> 5</a>
</span><span class="lnt" id="hl-1-6"><a class="lnlinks" href="#hl-1-6"> 6</a>
</span><span class="lnt" id="hl-1-7"><a class="lnlinks" href="#hl-1-7"> 7</a>
</span><span class="lnt" id="hl-1-8"><a class="lnlinks" href="#hl-1-8"> 8</a>
</span><span class="lnt" id="hl-1-9"><a class="lnlinks" href="#hl-1-9"> 9</a>
</span><span class="lnt" id="hl-1-10"><a class="lnlinks" href="#hl-1-10">10</a>
</span><span class="lnt" id="hl-1-11"><a class="lnlinks" href="#hl-1-11">11</a>
</span><span class="lnt" id="hl-1-12"><a class="lnlinks" href="#hl-1-12">12</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">year</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;ddl_year&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sea</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;ddl_sea&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">province</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;ddl_province&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">city</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;ddl_city&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">year</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;2020&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sea</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;全部&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">province</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;全部&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">city</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;全部&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">botton</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;btn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">botton</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>获取表头和数据，并整理成二维数组的类型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-2-1"><a class="lnlinks" href="#hl-2-1"> 1</a>
</span><span class="lnt" id="hl-2-2"><a class="lnlinks" href="#hl-2-2"> 2</a>
</span><span class="lnt" id="hl-2-3"><a class="lnlinks" href="#hl-2-3"> 3</a>
</span><span class="lnt" id="hl-2-4"><a class="lnlinks" href="#hl-2-4"> 4</a>
</span><span class="lnt" id="hl-2-5"><a class="lnlinks" href="#hl-2-5"> 5</a>
</span><span class="lnt" id="hl-2-6"><a class="lnlinks" href="#hl-2-6"> 6</a>
</span><span class="lnt" id="hl-2-7"><a class="lnlinks" href="#hl-2-7"> 7</a>
</span><span class="lnt" id="hl-2-8"><a class="lnlinks" href="#hl-2-8"> 8</a>
</span><span class="lnt" id="hl-2-9"><a class="lnlinks" href="#hl-2-9"> 9</a>
</span><span class="lnt" id="hl-2-10"><a class="lnlinks" href="#hl-2-10">10</a>
</span><span class="lnt" id="hl-2-11"><a class="lnlinks" href="#hl-2-11">11</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">header</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;gridHd&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">heads</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">body</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;gridDatas&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">predatas</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predatas</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">row</span> <span class="o">=</span> <span class="n">predatas</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predatas</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>把2021年的数据也添加到数组里，转换成data frame。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-3-1"><a class="lnlinks" href="#hl-3-1"> 1</a>
</span><span class="lnt" id="hl-3-2"><a class="lnlinks" href="#hl-3-2"> 2</a>
</span><span class="lnt" id="hl-3-3"><a class="lnlinks" href="#hl-3-3"> 3</a>
</span><span class="lnt" id="hl-3-4"><a class="lnlinks" href="#hl-3-4"> 4</a>
</span><span class="lnt" id="hl-3-5"><a class="lnlinks" href="#hl-3-5"> 5</a>
</span><span class="lnt" id="hl-3-6"><a class="lnlinks" href="#hl-3-6"> 6</a>
</span><span class="lnt" id="hl-3-7"><a class="lnlinks" href="#hl-3-7"> 7</a>
</span><span class="lnt" id="hl-3-8"><a class="lnlinks" href="#hl-3-8"> 8</a>
</span><span class="lnt" id="hl-3-9"><a class="lnlinks" href="#hl-3-9"> 9</a>
</span><span class="lnt" id="hl-3-10"><a class="lnlinks" href="#hl-3-10">10</a>
</span><span class="lnt" id="hl-3-11"><a class="lnlinks" href="#hl-3-11">11</a>
</span><span class="lnt" id="hl-3-12"><a class="lnlinks" href="#hl-3-12">12</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">year</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;2021&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">botton</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">body</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;gridDatas&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">predatas</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predatas</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">row</span> <span class="o">=</span> <span class="n">predatas</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predatas</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">heads</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="数据整理和保存">数据整理和保存<a hidden class="anchor" aria-hidden="true" href="#数据整理和保存">#</a></h2>
<p>发现部分监测点数据位移，原因是部分监测点的溶解氧数据缺失，还有一些数据点的溶解氧和石油类数据都缺失。对这些监测点的信息进行修正，缺失的地方用<code>None</code>标记。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-4-1"><a class="lnlinks" href="#hl-4-1">1</a>
</span><span class="lnt" id="hl-4-2"><a class="lnlinks" href="#hl-4-2">2</a>
</span><span class="lnt" id="hl-4-3"><a class="lnlinks" href="#hl-4-3">3</a>
</span><span class="lnt" id="hl-4-4"><a class="lnlinks" href="#hl-4-4">4</a>
</span><span class="lnt" id="hl-4-5"><a class="lnlinks" href="#hl-4-5">5</a>
</span><span class="lnt" id="hl-4-6"><a class="lnlinks" href="#hl-4-6">6</a>
</span><span class="lnt" id="hl-4-7"><a class="lnlinks" href="#hl-4-7">7</a>
</span><span class="lnt" id="hl-4-8"><a class="lnlinks" href="#hl-4-8">8</a>
</span><span class="lnt" id="hl-4-9"><a class="lnlinks" href="#hl-4-9">9</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>保存数据到本地。此时数据全都以字符串保存。缺失值标记为“None”，低于检出限的数据标记为“未检出”，或根据检出限的值标记为“&lt;0.01”或“&lt;0.1”。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-5-1"><a class="lnlinks" href="#hl-5-1">1</a>
</span><span class="lnt" id="hl-5-2"><a class="lnlinks" href="#hl-5-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">wd</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;./Data.pkl&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/image-20220424020754676.png" alt="image-20220424020754676"  />
</p>
<h1 id="水质类别动态变化">水质类别动态变化<a hidden class="anchor" aria-hidden="true" href="#水质类别动态变化">#</a></h1>
<p>根据每个月水质监测数据的经纬度信息和水质类别作图。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-6-1"><a class="lnlinks" href="#hl-6-1">1</a>
</span><span class="lnt" id="hl-6-2"><a class="lnlinks" href="#hl-6-2">2</a>
</span><span class="lnt" id="hl-6-3"><a class="lnlinks" href="#hl-6-3">3</a>
</span><span class="lnt" id="hl-6-4"><a class="lnlinks" href="#hl-6-4">4</a>
</span><span class="lnt" id="hl-6-5"><a class="lnlinks" href="#hl-6-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;./Data.pkl&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看一下水质类别有哪些分类，执行<code>data['水质类别'].value_counts()</code>，输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-7-1"><a class="lnlinks" href="#hl-7-1">1</a>
</span><span class="lnt" id="hl-7-2"><a class="lnlinks" href="#hl-7-2">2</a>
</span><span class="lnt" id="hl-7-3"><a class="lnlinks" href="#hl-7-3">3</a>
</span><span class="lnt" id="hl-7-4"><a class="lnlinks" href="#hl-7-4">4</a>
</span><span class="lnt" id="hl-7-5"><a class="lnlinks" href="#hl-7-5">5</a>
</span><span class="lnt" id="hl-7-6"><a class="lnlinks" href="#hl-7-6">6</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">一类     4082
</span></span><span class="line"><span class="cl">二类     1343
</span></span><span class="line"><span class="cl">劣四类    1154
</span></span><span class="line"><span class="cl">三类      514
</span></span><span class="line"><span class="cl">四类      476
</span></span><span class="line"><span class="cl">Name: 水质类别, dtype: int64
</span></span></code></pre></td></tr></table>
</div>
</div><p>将经纬度数据转换成浮点型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-8-1"><a class="lnlinks" href="#hl-8-1">1</a>
</span><span class="lnt" id="hl-8-2"><a class="lnlinks" href="#hl-8-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span><span class="p">[</span><span class="s1">&#39;实测经度&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;实测经度&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">[</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义返回某年某月所有监测点坐标的函数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-9-1"><a class="lnlinks" href="#hl-9-1"> 1</a>
</span><span class="lnt" id="hl-9-2"><a class="lnlinks" href="#hl-9-2"> 2</a>
</span><span class="lnt" id="hl-9-3"><a class="lnlinks" href="#hl-9-3"> 3</a>
</span><span class="lnt" id="hl-9-4"><a class="lnlinks" href="#hl-9-4"> 4</a>
</span><span class="lnt" id="hl-9-5"><a class="lnlinks" href="#hl-9-5"> 5</a>
</span><span class="lnt" id="hl-9-6"><a class="lnlinks" href="#hl-9-6"> 6</a>
</span><span class="lnt" id="hl-9-7"><a class="lnlinks" href="#hl-9-7"> 7</a>
</span><span class="lnt" id="hl-9-8"><a class="lnlinks" href="#hl-9-8"> 8</a>
</span><span class="lnt" id="hl-9-9"><a class="lnlinks" href="#hl-9-9"> 9</a>
</span><span class="lnt" id="hl-9-10"><a class="lnlinks" href="#hl-9-10">10</a>
</span><span class="lnt" id="hl-9-11"><a class="lnlinks" href="#hl-9-11">11</a>
</span><span class="lnt" id="hl-9-12"><a class="lnlinks" href="#hl-9-12">12</a>
</span><span class="lnt" id="hl-9-13"><a class="lnlinks" href="#hl-9-13">13</a>
</span><span class="lnt" id="hl-9-14"><a class="lnlinks" href="#hl-9-14">14</a>
</span><span class="lnt" id="hl-9-15"><a class="lnlinks" href="#hl-9-15">15</a>
</span><span class="lnt" id="hl-9-16"><a class="lnlinks" href="#hl-9-16">16</a>
</span><span class="lnt" id="hl-9-17"><a class="lnlinks" href="#hl-9-17">17</a>
</span><span class="lnt" id="hl-9-18"><a class="lnlinks" href="#hl-9-18">18</a>
</span><span class="lnt" id="hl-9-19"><a class="lnlinks" href="#hl-9-19">19</a>
</span><span class="lnt" id="hl-9-20"><a class="lnlinks" href="#hl-9-20">20</a>
</span><span class="lnt" id="hl-9-21"><a class="lnlinks" href="#hl-9-21">21</a>
</span><span class="lnt" id="hl-9-22"><a class="lnlinks" href="#hl-9-22">22</a>
</span><span class="lnt" id="hl-9-23"><a class="lnlinks" href="#hl-9-23">23</a>
</span><span class="lnt" id="hl-9-24"><a class="lnlinks" href="#hl-9-24">24</a>
</span><span class="lnt" id="hl-9-25"><a class="lnlinks" href="#hl-9-25">25</a>
</span><span class="lnt" id="hl-9-26"><a class="lnlinks" href="#hl-9-26">26</a>
</span><span class="lnt" id="hl-9-27"><a class="lnlinks" href="#hl-9-27">27</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getlongitude</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">longitude_by_level</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;一类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测经度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;二类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测经度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;三类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测经度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;四类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测经度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;劣四类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测经度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">longitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">longitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">longitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">longitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">longitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">longitude_by_level</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getlatitude</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude_by_level</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;一类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;二类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;三类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;四类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;监测时间&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;水质类别&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;劣四类&#39;</span><span class="p">)][</span><span class="s1">&#39;实测纬度&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude_by_level</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">latitude_by_level</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义画出某年某月水质类别分布图的函数。将网上找的我国海岸线轮廓作为底图（网上下载下来是shp格式的，但是找到了一个很好的网站，可以将shp图层文件转换成位图 <a href="https://mapshaper.org/">https://mapshaper.org/</a>）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-10-1"><a class="lnlinks" href="#hl-10-1"> 1</a>
</span><span class="lnt" id="hl-10-2"><a class="lnlinks" href="#hl-10-2"> 2</a>
</span><span class="lnt" id="hl-10-3"><a class="lnlinks" href="#hl-10-3"> 3</a>
</span><span class="lnt" id="hl-10-4"><a class="lnlinks" href="#hl-10-4"> 4</a>
</span><span class="lnt" id="hl-10-5"><a class="lnlinks" href="#hl-10-5"> 5</a>
</span><span class="lnt" id="hl-10-6"><a class="lnlinks" href="#hl-10-6"> 6</a>
</span><span class="lnt" id="hl-10-7"><a class="lnlinks" href="#hl-10-7"> 7</a>
</span><span class="lnt" id="hl-10-8"><a class="lnlinks" href="#hl-10-8"> 8</a>
</span><span class="lnt" id="hl-10-9"><a class="lnlinks" href="#hl-10-9"> 9</a>
</span><span class="lnt" id="hl-10-10"><a class="lnlinks" href="#hl-10-10">10</a>
</span><span class="lnt" id="hl-10-11"><a class="lnlinks" href="#hl-10-11">11</a>
</span><span class="lnt" id="hl-10-12"><a class="lnlinks" href="#hl-10-12">12</a>
</span><span class="lnt" id="hl-10-13"><a class="lnlinks" href="#hl-10-13">13</a>
</span><span class="lnt" id="hl-10-14"><a class="lnlinks" href="#hl-10-14">14</a>
</span><span class="lnt" id="hl-10-15"><a class="lnlinks" href="#hl-10-15">15</a>
</span><span class="lnt" id="hl-10-16"><a class="lnlinks" href="#hl-10-16">16</a>
</span><span class="lnt" id="hl-10-17"><a class="lnlinks" href="#hl-10-17">17</a>
</span><span class="lnt" id="hl-10-18"><a class="lnlinks" href="#hl-10-18">18</a>
</span><span class="lnt" id="hl-10-19"><a class="lnlinks" href="#hl-10-19">19</a>
</span><span class="lnt" id="hl-10-20"><a class="lnlinks" href="#hl-10-20">20</a>
</span><span class="lnt" id="hl-10-21"><a class="lnlinks" href="#hl-10-21">21</a>
</span><span class="lnt" id="hl-10-22"><a class="lnlinks" href="#hl-10-22">22</a>
</span><span class="lnt" id="hl-10-23"><a class="lnlinks" href="#hl-10-23">23</a>
</span><span class="lnt" id="hl-10-24"><a class="lnlinks" href="#hl-10-24">24</a>
</span><span class="lnt" id="hl-10-25"><a class="lnlinks" href="#hl-10-25">25</a>
</span><span class="lnt" id="hl-10-26"><a class="lnlinks" href="#hl-10-26">26</a>
</span><span class="lnt" id="hl-10-27"><a class="lnlinks" href="#hl-10-27">27</a>
</span><span class="lnt" id="hl-10-28"><a class="lnlinks" href="#hl-10-28">28</a>
</span><span class="lnt" id="hl-10-29"><a class="lnlinks" href="#hl-10-29">29</a>
</span><span class="lnt" id="hl-10-30"><a class="lnlinks" href="#hl-10-30">30</a>
</span><span class="lnt" id="hl-10-31"><a class="lnlinks" href="#hl-10-31">31</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">draw_plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">longitude_by_level</span><span class="p">,</span><span class="n">latitude_by_level</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">128</span><span class="o">-</span><span class="mi">106</span><span class="p">),(</span><span class="mi">42</span><span class="o">-</span><span class="mi">14</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">longitude_by_level</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latitude_by_level</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;paleturquoise&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">EdgeColor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">longitude_by_level</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">latitude_by_level</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">EdgeColor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">longitude_by_level</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">latitude_by_level</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;cadetblue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">EdgeColor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">longitude_by_level</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">latitude_by_level</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">EdgeColor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">longitude_by_level</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">latitude_by_level</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkslategrey&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">EdgeColor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span><span class="c1">###解决中文乱码</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;一类&#39;</span><span class="p">,</span><span class="s1">&#39;二类&#39;</span><span class="p">,</span><span class="s1">&#39;三类&#39;</span><span class="p">,</span><span class="s1">&#39;四类&#39;</span><span class="p">,</span><span class="s1">&#39;劣四类&#39;</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">106</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">42</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">major_locator</span><span class="o">=</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">major_locator</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;经度(E°)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;纬度(N°)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;年&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;月我国沿海监测点水质类别情况&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;land-sea.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">zoom</span> <span class="o">=</span> <span class="mf">0.0221</span>
</span></span><span class="line"><span class="cl">    <span class="n">height</span><span class="p">,</span><span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">*</span><span class="n">zoom</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">zoom</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="mf">121.0</span><span class="p">,</span><span class="mf">22.1</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../沿海检测点水质类别变化/&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="o">+</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>生成2020-2021年每月的水质分布图。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-11-1"><a class="lnlinks" href="#hl-11-1">1</a>
</span><span class="lnt" id="hl-11-2"><a class="lnlinks" href="#hl-11-2">2</a>
</span><span class="lnt" id="hl-11-3"><a class="lnlinks" href="#hl-11-3">3</a>
</span><span class="lnt" id="hl-11-4"><a class="lnlinks" href="#hl-11-4">4</a>
</span><span class="lnt" id="hl-11-5"><a class="lnlinks" href="#hl-11-5">5</a>
</span><span class="lnt" id="hl-11-6"><a class="lnlinks" href="#hl-11-6">6</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2020&#39;</span><span class="p">,</span><span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span><span class="s1">&#39;02&#39;</span><span class="p">,</span><span class="s1">&#39;03&#39;</span><span class="p">,</span><span class="s1">&#39;04&#39;</span><span class="p">,</span><span class="s1">&#39;05&#39;</span><span class="p">,</span><span class="s1">&#39;06&#39;</span><span class="p">,</span><span class="s1">&#39;07&#39;</span><span class="p">,</span><span class="s1">&#39;08&#39;</span><span class="p">,</span><span class="s1">&#39;09&#39;</span><span class="p">,</span><span class="s1">&#39;10&#39;</span><span class="p">,</span><span class="s1">&#39;11&#39;</span><span class="p">,</span><span class="s1">&#39;12&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Drawing &#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">longitude_by_level</span> <span class="o">=</span> <span class="n">getlongitude</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">latitude_by_level</span> <span class="o">=</span> <span class="n">getlatitude</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">draw_plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">longitude_by_level</span><span class="p">,</span><span class="n">latitude_by_level</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/2020-05.jpg" alt="2020-05"  />
<p>将图片拼接成GIF动图。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-12-1"><a class="lnlinks" href="#hl-12-1">1</a>
</span><span class="lnt" id="hl-12-2"><a class="lnlinks" href="#hl-12-2">2</a>
</span><span class="lnt" id="hl-12-3"><a class="lnlinks" href="#hl-12-3">3</a>
</span><span class="lnt" id="hl-12-4"><a class="lnlinks" href="#hl-12-4">4</a>
</span><span class="lnt" id="hl-12-5"><a class="lnlinks" href="#hl-12-5">5</a>
</span><span class="lnt" id="hl-12-6"><a class="lnlinks" href="#hl-12-6">6</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">imageio</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">jpg_lst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;../沿海检测点水质类别变化/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">jpg_lst</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;../沿海检测点水质类别变化/&#39;</span> <span class="o">+</span> <span class="n">img</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="s2">&#34;../沿海检测点水质类别变化/result.gif&#34;</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/result.gif" alt="result"  />
</p>
<h1 id="简单数据分析正态性检验方差分析pearson分析和线性回归">简单数据分析：正态性检验、方差分析、Pearson分析和线性回归<a hidden class="anchor" aria-hidden="true" href="#简单数据分析正态性检验方差分析pearson分析和线性回归">#</a></h1>
<p>以“化学需氧量(mg/L)”为研究数据，考察不同海区/省份之间的海水COD差异性。首先将数据转换为数值类型，标记为“未检出”的数据记为0。由于方差分析适用于正态分布的样本，因此先对数据进行分布检验，变换为接近正态分布的形式后再进行方差分析。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-13-1"><a class="lnlinks" href="#hl-13-1"> 1</a>
</span><span class="lnt" id="hl-13-2"><a class="lnlinks" href="#hl-13-2"> 2</a>
</span><span class="lnt" id="hl-13-3"><a class="lnlinks" href="#hl-13-3"> 3</a>
</span><span class="lnt" id="hl-13-4"><a class="lnlinks" href="#hl-13-4"> 4</a>
</span><span class="lnt" id="hl-13-5"><a class="lnlinks" href="#hl-13-5"> 5</a>
</span><span class="lnt" id="hl-13-6"><a class="lnlinks" href="#hl-13-6"> 6</a>
</span><span class="lnt" id="hl-13-7"><a class="lnlinks" href="#hl-13-7"> 7</a>
</span><span class="lnt" id="hl-13-8"><a class="lnlinks" href="#hl-13-8"> 8</a>
</span><span class="lnt" id="hl-13-9"><a class="lnlinks" href="#hl-13-9"> 9</a>
</span><span class="lnt" id="hl-13-10"><a class="lnlinks" href="#hl-13-10">10</a>
</span><span class="lnt" id="hl-13-11"><a class="lnlinks" href="#hl-13-11">11</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">statsmodels.stats.anova</span> <span class="kn">import</span> <span class="n">anova_lm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span><span class="c1">###解决中文乱码</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="数据清理和转换">数据清理和转换<a hidden class="anchor" aria-hidden="true" href="#数据清理和转换">#</a></h2>
<p>首先读取数据，转换成浮点型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-14-1"><a class="lnlinks" href="#hl-14-1">1</a>
</span><span class="lnt" id="hl-14-2"><a class="lnlinks" href="#hl-14-2">2</a>
</span><span class="lnt" id="hl-14-3"><a class="lnlinks" href="#hl-14-3">3</a>
</span><span class="lnt" id="hl-14-4"><a class="lnlinks" href="#hl-14-4">4</a>
</span><span class="lnt" id="hl-14-5"><a class="lnlinks" href="#hl-14-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;./Data.pkl&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">cod</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;未检出&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cod</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">cod</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">cod</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>从原始数据的直方图大致看一下分布情况。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-15-1"><a class="lnlinks" href="#hl-15-1">1</a>
</span><span class="lnt" id="hl-15-2"><a class="lnlinks" href="#hl-15-2">2</a>
</span><span class="lnt" id="hl-15-3"><a class="lnlinks" href="#hl-15-3">3</a>
</span><span class="lnt" id="hl-15-4"><a class="lnlinks" href="#hl-15-4">4</a>
</span><span class="lnt" id="hl-15-5"><a class="lnlinks" href="#hl-15-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">cod</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cod</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">cod</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;COD(mg/L)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="%e6%88%91%e5%9b%bd%e6%b5%b7%e6%b0%b4%e6%b0%b4%e8%b4%a8%e6%95%b0%e6%8d%ae%e5%88%86%e6%9e%90/image-20220424021524945.png" alt="image-20220424021524945"  />
</p>
<p>可以看出样本是明显有偏的，计算样本的偏度（Skewness）和峰度（Kurtosis）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-16-1"><a class="lnlinks" href="#hl-16-1">1</a>
</span><span class="lnt" id="hl-16-2"><a class="lnlinks" href="#hl-16-2">2</a>
</span><span class="lnt" id="hl-16-3"><a class="lnlinks" href="#hl-16-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">cod</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="o">=</span> <span class="n">cod</span><span class="o">.</span><span class="n">kurt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;偏度 = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, 峰度 = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-17-1"><a class="lnlinks" href="#hl-17-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">偏度 = 4.58614227400281, 峰度 = 43.47585104239013
</span></span></code></pre></td></tr></table>
</div>
</div><p>偏度$S&gt;0$，表明样本正偏，数据出现右侧长尾；峰度$K&gt;6$，表明分布陡峭。尝试通过取对数得到接近正态的分布。这里考虑到0的数据比较多，若采用$x&rsquo;=\lg(x+10^{-n})$的转换方法，会在$x=-n$的地方出现一个异常峰，所以决定舍弃0数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-18-1"><a class="lnlinks" href="#hl-18-1">1</a>
</span><span class="lnt" id="hl-18-2"><a class="lnlinks" href="#hl-18-2">2</a>
</span><span class="lnt" id="hl-18-3"><a class="lnlinks" href="#hl-18-3">3</a>
</span><span class="lnt" id="hl-18-4"><a class="lnlinks" href="#hl-18-4">4</a>
</span><span class="lnt" id="hl-18-5"><a class="lnlinks" href="#hl-18-5">5</a>
</span><span class="lnt" id="hl-18-6"><a class="lnlinks" href="#hl-18-6">6</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cod2 = pd.Series.copy(cod,deep=True)
</span></span><span class="line"><span class="cl">for i in cod2.index:
</span></span><span class="line"><span class="cl">    if cod[i] == 0:
</span></span><span class="line"><span class="cl">        del cod2[i]
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        cod2[i] = np.log10(cod[i])
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-19-1"><a class="lnlinks" href="#hl-19-1">1</a>
</span><span class="lnt" id="hl-19-2"><a class="lnlinks" href="#hl-19-2">2</a>
</span><span class="lnt" id="hl-19-3"><a class="lnlinks" href="#hl-19-3">3</a>
</span><span class="lnt" id="hl-19-4"><a class="lnlinks" href="#hl-19-4">4</a>
</span><span class="lnt" id="hl-19-5"><a class="lnlinks" href="#hl-19-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">cod2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cod2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">cod2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;log10(COD)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424021903070.png" alt="image-20220424021903070" style="zoom:33%;" />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-20-1"><a class="lnlinks" href="#hl-20-1">1</a>
</span><span class="lnt" id="hl-20-2"><a class="lnlinks" href="#hl-20-2">2</a>
</span><span class="lnt" id="hl-20-3"><a class="lnlinks" href="#hl-20-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">cod2</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="o">=</span> <span class="n">cod2</span><span class="o">.</span><span class="n">kurt</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;偏度 = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, 峰度 = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-21-1"><a class="lnlinks" href="#hl-21-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">偏度 = 0.08821022006460341, 峰度 = 0.6118708597667646
</span></span></code></pre></td></tr></table>
</div>
</div><p>转换后的样本偏度约等于零，可以近似认为样本是无偏的。考虑到样本量&gt;7500，根据大数定理认为样本总体符合正态分布。</p>
<blockquote>
<p>事实上如果用K-S检验，还是会发现不能通过正态性检验的。可能是因为数据的差异性大，所以样本数量还远远不够；也有可能是因为数据本身的采样有偏，事实上水质监测数据确实不是完全随机时刻和取点的，会受到采样点设置偏好的影响。这里只是凭借大数定理和Q-Q图，定性地认为服从正态分布。</p>
</blockquote>
<p>用Q-Q图辅助判断，处理后的数据点更好地分布在对角线上。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-22-1"><a class="lnlinks" href="#hl-22-1">1</a>
</span><span class="lnt" id="hl-22-2"><a class="lnlinks" href="#hl-22-2">2</a>
</span><span class="lnt" id="hl-22-3"><a class="lnlinks" href="#hl-22-3">3</a>
</span><span class="lnt" id="hl-22-4"><a class="lnlinks" href="#hl-22-4">4</a>
</span><span class="lnt" id="hl-22-5"><a class="lnlinks" href="#hl-22-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">cod</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&#34;norm&#34;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">cod2</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&#34;norm&#34;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Logarithmic Data&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/image-20220424022527148.png" alt="image-20220424022527148"  />
</p>
<h2 id="方差分析">方差分析<a hidden class="anchor" aria-hidden="true" href="#方差分析">#</a></h2>
<p>获取海区和省份的数据（定类数据），和对数化的COD一起合成data frame。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-23-1"><a class="lnlinks" href="#hl-23-1">1</a>
</span><span class="lnt" id="hl-23-2"><a class="lnlinks" href="#hl-23-2">2</a>
</span><span class="lnt" id="hl-23-3"><a class="lnlinks" href="#hl-23-3">3</a>
</span><span class="lnt" id="hl-23-4"><a class="lnlinks" href="#hl-23-4">4</a>
</span><span class="lnt" id="hl-23-5"><a class="lnlinks" href="#hl-23-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">anova_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">,</span><span class="s1">&#39;省份&#39;</span><span class="p">,</span><span class="s1">&#39;logCOD&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod2</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">sea</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">province</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;省份&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">anova_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sea</span><span class="p">,</span> <span class="n">province</span><span class="p">,</span> <span class="n">cod2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>先用箱型图看一下四大海区的分布差异。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-24-1"><a class="lnlinks" href="#hl-24-1">1</a>
</span><span class="lnt" id="hl-24-2"><a class="lnlinks" href="#hl-24-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;海区&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;logCOD&#39;</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">anova_data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424022854526.png" alt="image-20220424022854526" style="zoom:50%;" />
<p>单因素方差分析。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-25-1"><a class="lnlinks" href="#hl-25-1">1</a>
</span><span class="lnt" id="hl-25-2"><a class="lnlinks" href="#hl-25-2">2</a>
</span><span class="lnt" id="hl-25-3"><a class="lnlinks" href="#hl-25-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;logCOD ~ 海区&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">anova_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">anova_table</span> <span class="o">=</span> <span class="n">anova_lm</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">anova_table</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-26-1"><a class="lnlinks" href="#hl-26-1">1</a>
</span><span class="lnt" id="hl-26-2"><a class="lnlinks" href="#hl-26-2">2</a>
</span><span class="lnt" id="hl-26-3"><a class="lnlinks" href="#hl-26-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">              sum_sq      df           F         PR(&gt;F)
</span></span><span class="line"><span class="cl">海区         73.816704     3.0  390.048152  1.941560e-235
</span></span><span class="line"><span class="cl">Residual  473.062501  7499.0         NaN            NaN
</span></span></code></pre></td></tr></table>
</div>
</div><p>省份分布差异同理。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-27-1"><a class="lnlinks" href="#hl-27-1">1</a>
</span><span class="lnt" id="hl-27-2"><a class="lnlinks" href="#hl-27-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;省份&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;logCOD&#39;</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">anova_data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424023106157.png" alt="image-20220424023106157" style="zoom:50%;" />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-28-1"><a class="lnlinks" href="#hl-28-1">1</a>
</span><span class="lnt" id="hl-28-2"><a class="lnlinks" href="#hl-28-2">2</a>
</span><span class="lnt" id="hl-28-3"><a class="lnlinks" href="#hl-28-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;logCOD ~ 省份&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">anova_data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">anova_table</span> <span class="o">=</span> <span class="n">anova_lm</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">anova_table</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-29-1"><a class="lnlinks" href="#hl-29-1">1</a>
</span><span class="lnt" id="hl-29-2"><a class="lnlinks" href="#hl-29-2">2</a>
</span><span class="lnt" id="hl-29-3"><a class="lnlinks" href="#hl-29-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">              sum_sq      df           F  PR(&gt;F)
</span></span><span class="line"><span class="cl">省份        102.311302    11.0  156.722959     0.0
</span></span><span class="line"><span class="cl">Residual  444.567902  7491.0         NaN     NaN
</span></span></code></pre></td></tr></table>
</div>
</div><p>单因素方差分析P值均低于0.01，表明海区和省份因素都会使得COD数据产生显著差异。</p>
<h2 id="pearson相关分析">Pearson相关分析<a hidden class="anchor" aria-hidden="true" href="#pearson相关分析">#</a></h2>
<p>上面的分析是针对COD（定序变量）和海区/省份（定类变量）之间关系的分析。接下来选取“无机氮(mg/L)”数据，与COD数据进行定序变量的相关性分析。由于Pearson相关性分析要求两个变量均服从正态分布，因此对无机氮数据也要先进行数据清理和转换，取以10为底的对数。Q-Q图依然可以反映出处理前后的正态性变化。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-30-1"><a class="lnlinks" href="#hl-30-1">1</a>
</span><span class="lnt" id="hl-30-2"><a class="lnlinks" href="#hl-30-2">2</a>
</span><span class="lnt" id="hl-30-3"><a class="lnlinks" href="#hl-30-3">3</a>
</span><span class="lnt" id="hl-30-4"><a class="lnlinks" href="#hl-30-4">4</a>
</span><span class="lnt" id="hl-30-5"><a class="lnlinks" href="#hl-30-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ni</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;无机氮(mg/L)&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ni</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">ni</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ni2</span> <span class="o">=</span> <span class="n">ni</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ni</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ni2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ni</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-31-1"><a class="lnlinks" href="#hl-31-1">1</a>
</span><span class="lnt" id="hl-31-2"><a class="lnlinks" href="#hl-31-2">2</a>
</span><span class="lnt" id="hl-31-3"><a class="lnlinks" href="#hl-31-3">3</a>
</span><span class="lnt" id="hl-31-4"><a class="lnlinks" href="#hl-31-4">4</a>
</span><span class="lnt" id="hl-31-5"><a class="lnlinks" href="#hl-31-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&#34;norm&#34;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">ni2</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&#34;norm&#34;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Logarithmic Data&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/image-20220424023434570.png" alt="image-20220424023434570"  />
</p>
<p>由于有些监测点只有化学需氧量数据，没有无机氮数据，因此需要进行数据清理，将这些监测点删除。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-32-1"><a class="lnlinks" href="#hl-32-1">1</a>
</span><span class="lnt" id="hl-32-2"><a class="lnlinks" href="#hl-32-2">2</a>
</span><span class="lnt" id="hl-32-3"><a class="lnlinks" href="#hl-32-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cod2</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="n">ni2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>进行Pearson检验。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-33-1"><a class="lnlinks" href="#hl-33-1">1</a>
</span><span class="lnt" id="hl-33-2"><a class="lnlinks" href="#hl-33-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">r</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">ni2</span><span class="p">,</span><span class="n">cod2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pearson检验，相关系数 = </span><span class="si">%f</span><span class="s1">, P值 = </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-34-1"><a class="lnlinks" href="#hl-34-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Pearson检验，相关系数 = 0.446809, P值 = 0.000000
</span></span></code></pre></td></tr></table>
</div>
</div><p>$r\in(0.4,0.6)$，认为$\lg(\rm COD)$和$\lg(\rm N)$之间为中等程度正相关。通过散点图分布情况也可以感性判断出这一规律。</p>
<h2 id="线性回归">线性回归<a hidden class="anchor" aria-hidden="true" href="#线性回归">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-35-1"><a class="lnlinks" href="#hl-35-1">1</a>
</span><span class="lnt" id="hl-35-2"><a class="lnlinks" href="#hl-35-2">2</a>
</span><span class="lnt" id="hl-35-3"><a class="lnlinks" href="#hl-35-3">3</a>
</span><span class="lnt" id="hl-35-4"><a class="lnlinks" href="#hl-35-4">4</a>
</span><span class="lnt" id="hl-35-5"><a class="lnlinks" href="#hl-35-5">5</a>
</span><span class="lnt" id="hl-35-6"><a class="lnlinks" href="#hl-35-6">6</a>
</span><span class="lnt" id="hl-35-7"><a class="lnlinks" href="#hl-35-7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">ni</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">          <span class="n">cod</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">predict_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ni2</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;线性回归斜率：&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">截距：&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">R方：&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ni</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span><span class="n">cod</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-36-1"><a class="lnlinks" href="#hl-36-1">1</a>
</span><span class="lnt" id="hl-36-2"><a class="lnlinks" href="#hl-36-2">2</a>
</span><span class="lnt" id="hl-36-3"><a class="lnlinks" href="#hl-36-3">3</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">线性回归斜率： [1.10361078] 
</span></span><span class="line"><span class="cl">截距： 0.7039567080504857 
</span></span><span class="line"><span class="cl">R方： 0.24820547860780384
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-37-1"><a class="lnlinks" href="#hl-37-1">1</a>
</span><span class="lnt" id="hl-37-2"><a class="lnlinks" href="#hl-37-2">2</a>
</span><span class="lnt" id="hl-37-3"><a class="lnlinks" href="#hl-37-3">3</a>
</span><span class="lnt" id="hl-37-4"><a class="lnlinks" href="#hl-37-4">4</a>
</span><span class="lnt" id="hl-37-5"><a class="lnlinks" href="#hl-37-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ni2</span><span class="p">,</span><span class="n">cod2</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ni2</span><span class="p">,</span><span class="n">predict_y</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;logN&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;logCOD&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424023919558.png" alt="image-20220424023919558" style="zoom: 50%;" />
<p>考虑到海水地理位置对相关性的影响，再分海区绘制散点图和回归曲线。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-38-1"><a class="lnlinks" href="#hl-38-1"> 1</a>
</span><span class="lnt" id="hl-38-2"><a class="lnlinks" href="#hl-38-2"> 2</a>
</span><span class="lnt" id="hl-38-3"><a class="lnlinks" href="#hl-38-3"> 3</a>
</span><span class="lnt" id="hl-38-4"><a class="lnlinks" href="#hl-38-4"> 4</a>
</span><span class="lnt" id="hl-38-5"><a class="lnlinks" href="#hl-38-5"> 5</a>
</span><span class="lnt" id="hl-38-6"><a class="lnlinks" href="#hl-38-6"> 6</a>
</span><span class="lnt" id="hl-38-7"><a class="lnlinks" href="#hl-38-7"> 7</a>
</span><span class="lnt" id="hl-38-8"><a class="lnlinks" href="#hl-38-8"> 8</a>
</span><span class="lnt" id="hl-38-9"><a class="lnlinks" href="#hl-38-9"> 9</a>
</span><span class="lnt" id="hl-38-10"><a class="lnlinks" href="#hl-38-10">10</a>
</span><span class="lnt" id="hl-38-11"><a class="lnlinks" href="#hl-38-11">11</a>
</span><span class="lnt" id="hl-38-12"><a class="lnlinks" href="#hl-38-12">12</a>
</span><span class="lnt" id="hl-38-13"><a class="lnlinks" href="#hl-38-13">13</a>
</span><span class="lnt" id="hl-38-14"><a class="lnlinks" href="#hl-38-14">14</a>
</span><span class="lnt" id="hl-38-15"><a class="lnlinks" href="#hl-38-15">15</a>
</span><span class="lnt" id="hl-38-16"><a class="lnlinks" href="#hl-38-16">16</a>
</span><span class="lnt" id="hl-38-17"><a class="lnlinks" href="#hl-38-17">17</a>
</span><span class="lnt" id="hl-38-18"><a class="lnlinks" href="#hl-38-18">18</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sl_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">,</span><span class="s1">&#39;logN&#39;</span><span class="p">,</span><span class="s1">&#39;logCOD&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod2</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">sea</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sl_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sea</span><span class="p">,</span> <span class="n">ni2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cod2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">seas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;黄海&#39;</span><span class="p">,</span><span class="s1">&#39;渤海&#39;</span><span class="p">,</span><span class="s1">&#39;东海&#39;</span><span class="p">,</span><span class="s1">&#39;南海&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">predicts</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">seas</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;logN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">              <span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">seas</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;logCOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">predict_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">seas</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;logN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">predicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predict_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">seas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">线性回归斜率：&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">截距：&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">R方：&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">seas</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;logN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                               <span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">seas</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;logCOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-39-1"><a class="lnlinks" href="#hl-39-1"> 1</a>
</span><span class="lnt" id="hl-39-2"><a class="lnlinks" href="#hl-39-2"> 2</a>
</span><span class="lnt" id="hl-39-3"><a class="lnlinks" href="#hl-39-3"> 3</a>
</span><span class="lnt" id="hl-39-4"><a class="lnlinks" href="#hl-39-4"> 4</a>
</span><span class="lnt" id="hl-39-5"><a class="lnlinks" href="#hl-39-5"> 5</a>
</span><span class="lnt" id="hl-39-6"><a class="lnlinks" href="#hl-39-6"> 6</a>
</span><span class="lnt" id="hl-39-7"><a class="lnlinks" href="#hl-39-7"> 7</a>
</span><span class="lnt" id="hl-39-8"><a class="lnlinks" href="#hl-39-8"> 8</a>
</span><span class="lnt" id="hl-39-9"><a class="lnlinks" href="#hl-39-9"> 9</a>
</span><span class="lnt" id="hl-39-10"><a class="lnlinks" href="#hl-39-10">10</a>
</span><span class="lnt" id="hl-39-11"><a class="lnlinks" href="#hl-39-11">11</a>
</span><span class="lnt" id="hl-39-12"><a class="lnlinks" href="#hl-39-12">12</a>
</span><span class="lnt" id="hl-39-13"><a class="lnlinks" href="#hl-39-13">13</a>
</span><span class="lnt" id="hl-39-14"><a class="lnlinks" href="#hl-39-14">14</a>
</span><span class="lnt" id="hl-39-15"><a class="lnlinks" href="#hl-39-15">15</a>
</span><span class="lnt" id="hl-39-16"><a class="lnlinks" href="#hl-39-16">16</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">黄海 
</span></span><span class="line"><span class="cl">线性回归斜率： [0.26539399] 
</span></span><span class="line"><span class="cl">截距： 0.081372330354296 
</span></span><span class="line"><span class="cl">R方： 0.14307643170710227
</span></span><span class="line"><span class="cl">渤海 
</span></span><span class="line"><span class="cl">线性回归斜率： [0.27080498] 
</span></span><span class="line"><span class="cl">截距： 0.20731753294507865 
</span></span><span class="line"><span class="cl">R方： 0.1352474744941149
</span></span><span class="line"><span class="cl">东海 
</span></span><span class="line"><span class="cl">线性回归斜率： [0.63405663] 
</span></span><span class="line"><span class="cl">截距： 0.0898058817788494 
</span></span><span class="line"><span class="cl">R方： 0.3550328969220925
</span></span><span class="line"><span class="cl">南海 
</span></span><span class="line"><span class="cl">线性回归斜率： [0.36912331] 
</span></span><span class="line"><span class="cl">截距： 0.012211050912901922 
</span></span><span class="line"><span class="cl">R方： 0.1838150602146984
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-40-1"><a class="lnlinks" href="#hl-40-1"> 1</a>
</span><span class="lnt" id="hl-40-2"><a class="lnlinks" href="#hl-40-2"> 2</a>
</span><span class="lnt" id="hl-40-3"><a class="lnlinks" href="#hl-40-3"> 3</a>
</span><span class="lnt" id="hl-40-4"><a class="lnlinks" href="#hl-40-4"> 4</a>
</span><span class="lnt" id="hl-40-5"><a class="lnlinks" href="#hl-40-5"> 5</a>
</span><span class="lnt" id="hl-40-6"><a class="lnlinks" href="#hl-40-6"> 6</a>
</span><span class="lnt" id="hl-40-7"><a class="lnlinks" href="#hl-40-7"> 7</a>
</span><span class="lnt" id="hl-40-8"><a class="lnlinks" href="#hl-40-8"> 8</a>
</span><span class="lnt" id="hl-40-9"><a class="lnlinks" href="#hl-40-9"> 9</a>
</span><span class="lnt" id="hl-40-10"><a class="lnlinks" href="#hl-40-10">10</a>
</span><span class="lnt" id="hl-40-11"><a class="lnlinks" href="#hl-40-11">11</a>
</span><span class="lnt" id="hl-40-12"><a class="lnlinks" href="#hl-40-12">12</a>
</span><span class="lnt" id="hl-40-13"><a class="lnlinks" href="#hl-40-13">13</a>
</span><span class="lnt" id="hl-40-14"><a class="lnlinks" href="#hl-40-14">14</a>
</span><span class="lnt" id="hl-40-15"><a class="lnlinks" href="#hl-40-15">15</a>
</span><span class="lnt" id="hl-40-16"><a class="lnlinks" href="#hl-40-16">16</a>
</span><span class="lnt" id="hl-40-17"><a class="lnlinks" href="#hl-40-17">17</a>
</span><span class="lnt" id="hl-40-18"><a class="lnlinks" href="#hl-40-18">18</a>
</span><span class="lnt" id="hl-40-19"><a class="lnlinks" href="#hl-40-19">19</a>
</span><span class="lnt" id="hl-40-20"><a class="lnlinks" href="#hl-40-20">20</a>
</span><span class="lnt" id="hl-40-21"><a class="lnlinks" href="#hl-40-21">21</a>
</span><span class="lnt" id="hl-40-22"><a class="lnlinks" href="#hl-40-22">22</a>
</span><span class="lnt" id="hl-40-23"><a class="lnlinks" href="#hl-40-23">23</a>
</span><span class="lnt" id="hl-40-24"><a class="lnlinks" href="#hl-40-24">24</a>
</span><span class="lnt" id="hl-40-25"><a class="lnlinks" href="#hl-40-25">25</a>
</span><span class="lnt" id="hl-40-26"><a class="lnlinks" href="#hl-40-26">26</a>
</span><span class="lnt" id="hl-40-27"><a class="lnlinks" href="#hl-40-27">27</a>
</span><span class="lnt" id="hl-40-28"><a class="lnlinks" href="#hl-40-28">28</a>
</span><span class="lnt" id="hl-40-29"><a class="lnlinks" href="#hl-40-29">29</a>
</span><span class="lnt" id="hl-40-30"><a class="lnlinks" href="#hl-40-30">30</a>
</span><span class="lnt" id="hl-40-31"><a class="lnlinks" href="#hl-40-31">31</a>
</span><span class="lnt" id="hl-40-32"><a class="lnlinks" href="#hl-40-32">32</a>
</span><span class="lnt" id="hl-40-33"><a class="lnlinks" href="#hl-40-33">33</a>
</span><span class="lnt" id="hl-40-34"><a class="lnlinks" href="#hl-40-34">34</a>
</span><span class="lnt" id="hl-40-35"><a class="lnlinks" href="#hl-40-35">35</a>
</span><span class="lnt" id="hl-40-36"><a class="lnlinks" href="#hl-40-36">36</a>
</span><span class="lnt" id="hl-40-37"><a class="lnlinks" href="#hl-40-37">37</a>
</span><span class="lnt" id="hl-40-38"><a class="lnlinks" href="#hl-40-38">38</a>
</span><span class="lnt" id="hl-40-39"><a class="lnlinks" href="#hl-40-39">39</a>
</span><span class="lnt" id="hl-40-40"><a class="lnlinks" href="#hl-40-40">40</a>
</span><span class="lnt" id="hl-40-41"><a class="lnlinks" href="#hl-40-41">41</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;黄海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;黄海&#39;</span><span class="p">][</span><span class="s1">&#39;logCOD&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;黄海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span> <span class="n">predicts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;黄 海&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;logN&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;logCOD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.52</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;渤海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;渤海&#39;</span><span class="p">][</span><span class="s1">&#39;logCOD&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;渤海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span> <span class="n">predicts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;渤 海&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;logN&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;logCOD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.52</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;东海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;东海&#39;</span><span class="p">][</span><span class="s1">&#39;logCOD&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;东海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span> <span class="n">predicts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;东 海&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;logN&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;logCOD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.52</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;南海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;南海&#39;</span><span class="p">][</span><span class="s1">&#39;logCOD&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sl_data</span><span class="p">[</span><span class="n">sl_data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;南海&#39;</span><span class="p">][</span><span class="s1">&#39;logN&#39;</span><span class="p">],</span> <span class="n">predicts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;南 海&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;logN&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;logCOD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.52</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/image-20220424024129532.png" alt="image-20220424024129532"  />
</p>
<h1 id="机器学习">机器学习<a hidden class="anchor" aria-hidden="true" href="#机器学习">#</a></h1>
<p>为了从多个污染指标的层面上对不同海区的差异进行分析，以“化学需氧量(mg/L)”、“无机氮(mg/L)”、“活性磷酸盐(mg/L)”、“石油类(mg/L)”这四个指标作为自变量，将“海区”作为因变量，尝试用5种不同的模型进行机器学习，并找出预测准确度最高的模型进行进一步分析。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-41-1"><a class="lnlinks" href="#hl-41-1"> 1</a>
</span><span class="lnt" id="hl-41-2"><a class="lnlinks" href="#hl-41-2"> 2</a>
</span><span class="lnt" id="hl-41-3"><a class="lnlinks" href="#hl-41-3"> 3</a>
</span><span class="lnt" id="hl-41-4"><a class="lnlinks" href="#hl-41-4"> 4</a>
</span><span class="lnt" id="hl-41-5"><a class="lnlinks" href="#hl-41-5"> 5</a>
</span><span class="lnt" id="hl-41-6"><a class="lnlinks" href="#hl-41-6"> 6</a>
</span><span class="lnt" id="hl-41-7"><a class="lnlinks" href="#hl-41-7"> 7</a>
</span><span class="lnt" id="hl-41-8"><a class="lnlinks" href="#hl-41-8"> 8</a>
</span><span class="lnt" id="hl-41-9"><a class="lnlinks" href="#hl-41-9"> 9</a>
</span><span class="lnt" id="hl-41-10"><a class="lnlinks" href="#hl-41-10">10</a>
</span><span class="lnt" id="hl-41-11"><a class="lnlinks" href="#hl-41-11">11</a>
</span><span class="lnt" id="hl-41-12"><a class="lnlinks" href="#hl-41-12">12</a>
</span><span class="lnt" id="hl-41-13"><a class="lnlinks" href="#hl-41-13">13</a>
</span><span class="lnt" id="hl-41-14"><a class="lnlinks" href="#hl-41-14">14</a>
</span><span class="lnt" id="hl-41-15"><a class="lnlinks" href="#hl-41-15">15</a>
</span><span class="lnt" id="hl-41-16"><a class="lnlinks" href="#hl-41-16">16</a>
</span><span class="lnt" id="hl-41-17"><a class="lnlinks" href="#hl-41-17">17</a>
</span><span class="lnt" id="hl-41-18"><a class="lnlinks" href="#hl-41-18">18</a>
</span><span class="lnt" id="hl-41-19"><a class="lnlinks" href="#hl-41-19">19</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span><span class="c1">###解决中文乱码</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">explained_variance_score</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="数据清理">数据清理<a hidden class="anchor" aria-hidden="true" href="#数据清理">#</a></h2>
<p>首先把数据转换为数值类型。将标记为“未检出”、“&lt;0.01”、“&lt;0.1”的数据转换为0。将因变量（海区）数值化，标记成0~3。</p>
<table>
<thead>
<tr>
<th>海区</th>
<th>数值化</th>
</tr>
</thead>
<tbody>
<tr>
<td>黄海</td>
<td>0</td>
</tr>
<tr>
<td>渤海</td>
<td>1</td>
</tr>
<tr>
<td>东海</td>
<td>2</td>
</tr>
<tr>
<td>南海</td>
<td>3</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-42-1"><a class="lnlinks" href="#hl-42-1"> 1</a>
</span><span class="lnt" id="hl-42-2"><a class="lnlinks" href="#hl-42-2"> 2</a>
</span><span class="lnt" id="hl-42-3"><a class="lnlinks" href="#hl-42-3"> 3</a>
</span><span class="lnt" id="hl-42-4"><a class="lnlinks" href="#hl-42-4"> 4</a>
</span><span class="lnt" id="hl-42-5"><a class="lnlinks" href="#hl-42-5"> 5</a>
</span><span class="lnt" id="hl-42-6"><a class="lnlinks" href="#hl-42-6"> 6</a>
</span><span class="lnt" id="hl-42-7"><a class="lnlinks" href="#hl-42-7"> 7</a>
</span><span class="lnt" id="hl-42-8"><a class="lnlinks" href="#hl-42-8"> 8</a>
</span><span class="lnt" id="hl-42-9"><a class="lnlinks" href="#hl-42-9"> 9</a>
</span><span class="lnt" id="hl-42-10"><a class="lnlinks" href="#hl-42-10">10</a>
</span><span class="lnt" id="hl-42-11"><a class="lnlinks" href="#hl-42-11">11</a>
</span><span class="lnt" id="hl-42-12"><a class="lnlinks" href="#hl-42-12">12</a>
</span><span class="lnt" id="hl-42-13"><a class="lnlinks" href="#hl-42-13">13</a>
</span><span class="lnt" id="hl-42-14"><a class="lnlinks" href="#hl-42-14">14</a>
</span><span class="lnt" id="hl-42-15"><a class="lnlinks" href="#hl-42-15">15</a>
</span><span class="lnt" id="hl-42-16"><a class="lnlinks" href="#hl-42-16">16</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;黄海&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;渤海&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;东海&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;海区&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;化学需氧量(mg/L)&#39;</span><span class="p">,</span><span class="s1">&#39;无机氮(mg/L)&#39;</span><span class="p">,</span><span class="s1">&#39;活性磷酸盐(mg/L)&#39;</span><span class="p">,</span><span class="s1">&#39;石油类(mg/L)&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;未检出&#39;</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">D</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;海区&#39;</span><span class="p">,</span><span class="s1">&#39;化学需氧量(mg/L)&#39;</span><span class="p">,</span><span class="s1">&#39;无机氮(mg/L)&#39;</span><span class="p">,</span><span class="s1">&#39;活性磷酸盐(mg/L)&#39;</span><span class="p">,</span><span class="s1">&#39;石油类(mg/L)&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">D</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424024758504.png" alt="image-20220424024758504" style="zoom:50%;" />
<p>其中任何一项数据缺失的监测点都删除，最后把清理后的因变量保存为一维数组<code>Y</code>，自变量保存为四维数组<code>X</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-43-1"><a class="lnlinks" href="#hl-43-1">1</a>
</span><span class="lnt" id="hl-43-2"><a class="lnlinks" href="#hl-43-2">2</a>
</span><span class="lnt" id="hl-43-3"><a class="lnlinks" href="#hl-43-3">3</a>
</span><span class="lnt" id="hl-43-4"><a class="lnlinks" href="#hl-43-4">4</a>
</span><span class="lnt" id="hl-43-5"><a class="lnlinks" href="#hl-43-5">5</a>
</span><span class="lnt" id="hl-43-6"><a class="lnlinks" href="#hl-43-6">6</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">nanlist</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">nanlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">nanlist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">nanlist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="多模型比较">多模型比较<a hidden class="anchor" aria-hidden="true" href="#多模型比较">#</a></h2>
<p>划分训练集和测试机，特征缩放。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-44-1"><a class="lnlinks" href="#hl-44-1">1</a>
</span><span class="lnt" id="hl-44-2"><a class="lnlinks" href="#hl-44-2">2</a>
</span><span class="lnt" id="hl-44-3"><a class="lnlinks" href="#hl-44-3">3</a>
</span><span class="lnt" id="hl-44-4"><a class="lnlinks" href="#hl-44-4">4</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x_train</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">x_train</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x_test</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>用于对比的5种模型分别是：Decision Tree决策树、K-Nearest Neighbors K-最近邻（KNN）、Logistic Regression 逻辑回归、SVM支持向量机 (SVM)、Random Forest Tree随机森林。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-45-1"><a class="lnlinks" href="#hl-45-1"> 1</a>
</span><span class="lnt" id="hl-45-2"><a class="lnlinks" href="#hl-45-2"> 2</a>
</span><span class="lnt" id="hl-45-3"><a class="lnlinks" href="#hl-45-3"> 3</a>
</span><span class="lnt" id="hl-45-4"><a class="lnlinks" href="#hl-45-4"> 4</a>
</span><span class="lnt" id="hl-45-5"><a class="lnlinks" href="#hl-45-5"> 5</a>
</span><span class="lnt" id="hl-45-6"><a class="lnlinks" href="#hl-45-6"> 6</a>
</span><span class="lnt" id="hl-45-7"><a class="lnlinks" href="#hl-45-7"> 7</a>
</span><span class="lnt" id="hl-45-8"><a class="lnlinks" href="#hl-45-8"> 8</a>
</span><span class="lnt" id="hl-45-9"><a class="lnlinks" href="#hl-45-9"> 9</a>
</span><span class="lnt" id="hl-45-10"><a class="lnlinks" href="#hl-45-10">10</a>
</span><span class="lnt" id="hl-45-11"><a class="lnlinks" href="#hl-45-11">11</a>
</span><span class="lnt" id="hl-45-12"><a class="lnlinks" href="#hl-45-12">12</a>
</span><span class="lnt" id="hl-45-13"><a class="lnlinks" href="#hl-45-13">13</a>
</span><span class="lnt" id="hl-45-14"><a class="lnlinks" href="#hl-45-14">14</a>
</span><span class="lnt" id="hl-45-15"><a class="lnlinks" href="#hl-45-15">15</a>
</span><span class="lnt" id="hl-45-16"><a class="lnlinks" href="#hl-45-16">16</a>
</span><span class="lnt" id="hl-45-17"><a class="lnlinks" href="#hl-45-17">17</a>
</span><span class="lnt" id="hl-45-18"><a class="lnlinks" href="#hl-45-18">18</a>
</span><span class="lnt" id="hl-45-19"><a class="lnlinks" href="#hl-45-19">19</a>
</span><span class="lnt" id="hl-45-20"><a class="lnlinks" href="#hl-45-20">20</a>
</span><span class="lnt" id="hl-45-21"><a class="lnlinks" href="#hl-45-21">21</a>
</span><span class="lnt" id="hl-45-22"><a class="lnlinks" href="#hl-45-22">22</a>
</span><span class="lnt" id="hl-45-23"><a class="lnlinks" href="#hl-45-23">23</a>
</span><span class="lnt" id="hl-45-24"><a class="lnlinks" href="#hl-45-24">24</a>
</span><span class="lnt" id="hl-45-25"><a class="lnlinks" href="#hl-45-25">25</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 1. Decision Tree 决策树</span>
</span></span><span class="line"><span class="cl"><span class="n">tree_model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">criterion</span> <span class="o">=</span> <span class="s1">&#39;entropy&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">tree_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">tree_yhat</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. K-Nearest Neighbors K-最近邻 (KNN)</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl"><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">knn_yhat</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Logistic Regression 逻辑回归</span>
</span></span><span class="line"><span class="cl"><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">lr_yhat</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 4. SVM  支持向量机 (SVM)</span>
</span></span><span class="line"><span class="cl"><span class="n">svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#SVM要制作ROC曲线，必须probability=True，默认值False</span>
</span></span><span class="line"><span class="cl"><span class="n">svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">svm_yhat</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 5. Random Forest Tree 随机森林</span>
</span></span><span class="line"><span class="cl"><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rf_yhat</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>分别用accuracy score和F1-score来衡量不同模型的效果。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-46-1"><a class="lnlinks" href="#hl-46-1"> 1</a>
</span><span class="lnt" id="hl-46-2"><a class="lnlinks" href="#hl-46-2"> 2</a>
</span><span class="lnt" id="hl-46-3"><a class="lnlinks" href="#hl-46-3"> 3</a>
</span><span class="lnt" id="hl-46-4"><a class="lnlinks" href="#hl-46-4"> 4</a>
</span><span class="lnt" id="hl-46-5"><a class="lnlinks" href="#hl-46-5"> 5</a>
</span><span class="lnt" id="hl-46-6"><a class="lnlinks" href="#hl-46-6"> 6</a>
</span><span class="lnt" id="hl-46-7"><a class="lnlinks" href="#hl-46-7"> 7</a>
</span><span class="lnt" id="hl-46-8"><a class="lnlinks" href="#hl-46-8"> 8</a>
</span><span class="lnt" id="hl-46-9"><a class="lnlinks" href="#hl-46-9"> 9</a>
</span><span class="lnt" id="hl-46-10"><a class="lnlinks" href="#hl-46-10">10</a>
</span><span class="lnt" id="hl-46-11"><a class="lnlinks" href="#hl-46-11">11</a>
</span><span class="lnt" id="hl-46-12"><a class="lnlinks" href="#hl-46-12">12</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Model&#39;</span><span class="p">:</span>         <span class="p">[</span><span class="s1">&#39;Decision Tree model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;KNN model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;Logistic Regression model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;SVM model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;Random Forest Tree model&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Accuracy score&#39;</span><span class="p">:[</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree_yhat</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lr_yhat</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svm_yhat</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                      <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_yhat</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424025330318.png" alt="image-20220424025330318" style="zoom: 33%;" />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-47-1"><a class="lnlinks" href="#hl-47-1"> 1</a>
</span><span class="lnt" id="hl-47-2"><a class="lnlinks" href="#hl-47-2"> 2</a>
</span><span class="lnt" id="hl-47-3"><a class="lnlinks" href="#hl-47-3"> 3</a>
</span><span class="lnt" id="hl-47-4"><a class="lnlinks" href="#hl-47-4"> 4</a>
</span><span class="lnt" id="hl-47-5"><a class="lnlinks" href="#hl-47-5"> 5</a>
</span><span class="lnt" id="hl-47-6"><a class="lnlinks" href="#hl-47-6"> 6</a>
</span><span class="lnt" id="hl-47-7"><a class="lnlinks" href="#hl-47-7"> 7</a>
</span><span class="lnt" id="hl-47-8"><a class="lnlinks" href="#hl-47-8"> 8</a>
</span><span class="lnt" id="hl-47-9"><a class="lnlinks" href="#hl-47-9"> 9</a>
</span><span class="lnt" id="hl-47-10"><a class="lnlinks" href="#hl-47-10">10</a>
</span><span class="lnt" id="hl-47-11"><a class="lnlinks" href="#hl-47-11">11</a>
</span><span class="lnt" id="hl-47-12"><a class="lnlinks" href="#hl-47-12">12</a>
</span><span class="lnt" id="hl-47-13"><a class="lnlinks" href="#hl-47-13">13</a>
</span><span class="lnt" id="hl-47-14"><a class="lnlinks" href="#hl-47-14">14</a>
</span><span class="lnt" id="hl-47-15"><a class="lnlinks" href="#hl-47-15">15</a>
</span><span class="lnt" id="hl-47-16"><a class="lnlinks" href="#hl-47-16">16</a>
</span><span class="lnt" id="hl-47-17"><a class="lnlinks" href="#hl-47-17">17</a>
</span><span class="lnt" id="hl-47-18"><a class="lnlinks" href="#hl-47-18">18</a>
</span><span class="lnt" id="hl-47-19"><a class="lnlinks" href="#hl-47-19">19</a>
</span><span class="lnt" id="hl-47-20"><a class="lnlinks" href="#hl-47-20">20</a>
</span><span class="lnt" id="hl-47-21"><a class="lnlinks" href="#hl-47-21">21</a>
</span><span class="lnt" id="hl-47-22"><a class="lnlinks" href="#hl-47-22">22</a>
</span><span class="lnt" id="hl-47-23"><a class="lnlinks" href="#hl-47-23">23</a>
</span><span class="lnt" id="hl-47-24"><a class="lnlinks" href="#hl-47-24">24</a>
</span><span class="lnt" id="hl-47-25"><a class="lnlinks" href="#hl-47-25">25</a>
</span><span class="lnt" id="hl-47-26"><a class="lnlinks" href="#hl-47-26">26</a>
</span><span class="lnt" id="hl-47-27"><a class="lnlinks" href="#hl-47-27">27</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Model&#39;</span><span class="p">:</span>              <span class="p">[</span><span class="s1">&#39;Decision Tree model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;KNN model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;Logistic Regression model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;SVM model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;Random Forest Tree model&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;黄海(0)&#39;</span><span class="p">:[</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lr_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svm_yhat</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;渤海(1)&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lr_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svm_yhat</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;东海(2)&#39;</span><span class="p">:[</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lr_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svm_yhat</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;南海(3)&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lr_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svm_yhat</span><span class="p">,</span><span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                 <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_yhat</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">3</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424025454282.png" alt="image-20220424025454282" style="zoom: 33%;" />
<p>通过混淆矩阵也可以判断不同模型的预测能力，并且比较不同海区的数据被正确判断或误判为其他海区的可能性。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-48-1"><a class="lnlinks" href="#hl-48-1"> 1</a>
</span><span class="lnt" id="hl-48-2"><a class="lnlinks" href="#hl-48-2"> 2</a>
</span><span class="lnt" id="hl-48-3"><a class="lnlinks" href="#hl-48-3"> 3</a>
</span><span class="lnt" id="hl-48-4"><a class="lnlinks" href="#hl-48-4"> 4</a>
</span><span class="lnt" id="hl-48-5"><a class="lnlinks" href="#hl-48-5"> 5</a>
</span><span class="lnt" id="hl-48-6"><a class="lnlinks" href="#hl-48-6"> 6</a>
</span><span class="lnt" id="hl-48-7"><a class="lnlinks" href="#hl-48-7"> 7</a>
</span><span class="lnt" id="hl-48-8"><a class="lnlinks" href="#hl-48-8"> 8</a>
</span><span class="lnt" id="hl-48-9"><a class="lnlinks" href="#hl-48-9"> 9</a>
</span><span class="lnt" id="hl-48-10"><a class="lnlinks" href="#hl-48-10">10</a>
</span><span class="lnt" id="hl-48-11"><a class="lnlinks" href="#hl-48-11">11</a>
</span><span class="lnt" id="hl-48-12"><a class="lnlinks" href="#hl-48-12">12</a>
</span><span class="lnt" id="hl-48-13"><a class="lnlinks" href="#hl-48-13">13</a>
</span><span class="lnt" id="hl-48-14"><a class="lnlinks" href="#hl-48-14">14</a>
</span><span class="lnt" id="hl-48-15"><a class="lnlinks" href="#hl-48-15">15</a>
</span><span class="lnt" id="hl-48-16"><a class="lnlinks" href="#hl-48-16">16</a>
</span><span class="lnt" id="hl-48-17"><a class="lnlinks" href="#hl-48-17">17</a>
</span><span class="lnt" id="hl-48-18"><a class="lnlinks" href="#hl-48-18">18</a>
</span><span class="lnt" id="hl-48-19"><a class="lnlinks" href="#hl-48-19">19</a>
</span><span class="lnt" id="hl-48-20"><a class="lnlinks" href="#hl-48-20">20</a>
</span><span class="lnt" id="hl-48-21"><a class="lnlinks" href="#hl-48-21">21</a>
</span><span class="lnt" id="hl-48-22"><a class="lnlinks" href="#hl-48-22">22</a>
</span><span class="lnt" id="hl-48-23"><a class="lnlinks" href="#hl-48-23">23</a>
</span><span class="lnt" id="hl-48-24"><a class="lnlinks" href="#hl-48-24">24</a>
</span><span class="lnt" id="hl-48-25"><a class="lnlinks" href="#hl-48-25">25</a>
</span><span class="lnt" id="hl-48-26"><a class="lnlinks" href="#hl-48-26">26</a>
</span><span class="lnt" id="hl-48-27"><a class="lnlinks" href="#hl-48-27">27</a>
</span><span class="lnt" id="hl-48-28"><a class="lnlinks" href="#hl-48-28">28</a>
</span><span class="lnt" id="hl-48-29"><a class="lnlinks" href="#hl-48-29">29</a>
</span><span class="lnt" id="hl-48-30"><a class="lnlinks" href="#hl-48-30">30</a>
</span><span class="lnt" id="hl-48-31"><a class="lnlinks" href="#hl-48-31">31</a>
</span><span class="lnt" id="hl-48-32"><a class="lnlinks" href="#hl-48-32">32</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">tree_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">tree_yhat</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># Decision Tree</span>
</span></span><span class="line"><span class="cl"><span class="n">knn_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># K-Nearest Neighbors</span>
</span></span><span class="line"><span class="cl"><span class="n">lr_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lr_yhat</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># Logistic Regression</span>
</span></span><span class="line"><span class="cl"><span class="n">svm_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svm_yhat</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># Support Vector Machine</span>
</span></span><span class="line"><span class="cl"><span class="n">rf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_yhat</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># Random Forest Tree</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>    
</span></span><span class="line"><span class="cl">    <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;真实海区&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;预测海区&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">plot</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;黄海(0)&#39;</span><span class="p">,</span><span class="s1">&#39;渤海(1)&#39;</span><span class="p">,</span><span class="s1">&#39;东海(2)&#39;</span><span class="p">,</span><span class="s1">&#39;南海(3)&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tree_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Decision Tree&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">knn_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;KNN&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">lr_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">svm_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SVM&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rf_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Random Forest Tree&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/images/image-20220424025728647.png" alt="image-20220424025728647"  />
</p>
<h2 id="knn模型">KNN模型<a hidden class="anchor" aria-hidden="true" href="#knn模型">#</a></h2>
<p>综合以上，认为在当前的参数设置下KNN模型具有最好的解释力。输出KNN模型的分类报告。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-49-1"><a class="lnlinks" href="#hl-49-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_yhat</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-50-1"><a class="lnlinks" href="#hl-50-1"> 1</a>
</span><span class="lnt" id="hl-50-2"><a class="lnlinks" href="#hl-50-2"> 2</a>
</span><span class="lnt" id="hl-50-3"><a class="lnlinks" href="#hl-50-3"> 3</a>
</span><span class="lnt" id="hl-50-4"><a class="lnlinks" href="#hl-50-4"> 4</a>
</span><span class="lnt" id="hl-50-5"><a class="lnlinks" href="#hl-50-5"> 5</a>
</span><span class="lnt" id="hl-50-6"><a class="lnlinks" href="#hl-50-6"> 6</a>
</span><span class="lnt" id="hl-50-7"><a class="lnlinks" href="#hl-50-7"> 7</a>
</span><span class="lnt" id="hl-50-8"><a class="lnlinks" href="#hl-50-8"> 8</a>
</span><span class="lnt" id="hl-50-9"><a class="lnlinks" href="#hl-50-9"> 9</a>
</span><span class="lnt" id="hl-50-10"><a class="lnlinks" href="#hl-50-10">10</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">              precision    recall  f1-score   support
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">           0       0.52      0.62      0.57       370
</span></span><span class="line"><span class="cl">           1       0.56      0.61      0.59       295
</span></span><span class="line"><span class="cl">           2       0.71      0.70      0.70       446
</span></span><span class="line"><span class="cl">           3       0.59      0.46      0.52       398
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    accuracy                           0.60      1509
</span></span><span class="line"><span class="cl">   macro avg       0.60      0.60      0.59      1509
</span></span><span class="line"><span class="cl">weighted avg       0.60      0.60      0.60      1509
</span></span></code></pre></td></tr></table>
</div>
</div><p>本模型采用的是多分类模型，但是传统的ROC曲线和AUC只能用于描述不同于“0-1”分类模型。首先需要将因变量的测试集转换成类似于0-1分类的多维矩阵。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-51-1"><a class="lnlinks" href="#hl-51-1">1</a>
</span><span class="lnt" id="hl-51-2"><a class="lnlinks" href="#hl-51-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">y_test0 = np.array([[ 1 if y_test[i]==j else 0 for j in range(4) ] for i in range(len(y_test))], dtype=float)
</span></span><span class="line"><span class="cl">y_test0
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-52-1"><a class="lnlinks" href="#hl-52-1">1</a>
</span><span class="lnt" id="hl-52-2"><a class="lnlinks" href="#hl-52-2">2</a>
</span><span class="lnt" id="hl-52-3"><a class="lnlinks" href="#hl-52-3">3</a>
</span><span class="lnt" id="hl-52-4"><a class="lnlinks" href="#hl-52-4">4</a>
</span><span class="lnt" id="hl-52-5"><a class="lnlinks" href="#hl-52-5">5</a>
</span><span class="lnt" id="hl-52-6"><a class="lnlinks" href="#hl-52-6">6</a>
</span><span class="lnt" id="hl-52-7"><a class="lnlinks" href="#hl-52-7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">array([[0., 0., 1., 0.],
</span></span><span class="line"><span class="cl">       [0., 0., 1., 0.],
</span></span><span class="line"><span class="cl">       [0., 1., 0., 0.],
</span></span><span class="line"><span class="cl">       ...,
</span></span><span class="line"><span class="cl">       [1., 0., 0., 0.],
</span></span><span class="line"><span class="cl">       [0., 1., 0., 0.],
</span></span><span class="line"><span class="cl">       [0., 0., 1., 0.]])
</span></span></code></pre></td></tr></table>
</div>
</div><p>将转换后的因变量测试集和自变量测试集都按行展开，例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-53-1"><a class="lnlinks" href="#hl-53-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">y_test0</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-54-1"><a class="lnlinks" href="#hl-54-1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">array([0., 0., 1., ..., 0., 1., 0.])
</span></span></code></pre></td></tr></table>
</div>
</div><p>采用macro方法对多分类数据进行处理，然后再计算ROC曲线和AUC值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-55-1"><a class="lnlinks" href="#hl-55-1"> 1</a>
</span><span class="lnt" id="hl-55-2"><a class="lnlinks" href="#hl-55-2"> 2</a>
</span><span class="lnt" id="hl-55-3"><a class="lnlinks" href="#hl-55-3"> 3</a>
</span><span class="lnt" id="hl-55-4"><a class="lnlinks" href="#hl-55-4"> 4</a>
</span><span class="lnt" id="hl-55-5"><a class="lnlinks" href="#hl-55-5"> 5</a>
</span><span class="lnt" id="hl-55-6"><a class="lnlinks" href="#hl-55-6"> 6</a>
</span><span class="lnt" id="hl-55-7"><a class="lnlinks" href="#hl-55-7"> 7</a>
</span><span class="lnt" id="hl-55-8"><a class="lnlinks" href="#hl-55-8"> 8</a>
</span><span class="lnt" id="hl-55-9"><a class="lnlinks" href="#hl-55-9"> 9</a>
</span><span class="lnt" id="hl-55-10"><a class="lnlinks" href="#hl-55-10">10</a>
</span><span class="lnt" id="hl-55-11"><a class="lnlinks" href="#hl-55-11">11</a>
</span><span class="lnt" id="hl-55-12"><a class="lnlinks" href="#hl-55-12">12</a>
</span><span class="lnt" id="hl-55-13"><a class="lnlinks" href="#hl-55-13">13</a>
</span><span class="lnt" id="hl-55-14"><a class="lnlinks" href="#hl-55-14">14</a>
</span><span class="lnt" id="hl-55-15"><a class="lnlinks" href="#hl-55-15">15</a>
</span><span class="lnt" id="hl-55-16"><a class="lnlinks" href="#hl-55-16">16</a>
</span><span class="lnt" id="hl-55-17"><a class="lnlinks" href="#hl-55-17">17</a>
</span><span class="lnt" id="hl-55-18"><a class="lnlinks" href="#hl-55-18">18</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">y_pred</span><span class="o">=</span><span class="n">knn</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_test</span><span class="p">)[:,:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">roc_score</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovo&#39;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y_test0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">j</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">))],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fpr</span><span class="p">,</span><span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test0</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">pos_label</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="n">tpr</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;多分类ROC曲线&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&#34;假正率&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&#34;真正率&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="s2">&#34;AUC = &#34;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">roc_score</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><img src="/images/image-20220424030407019.png" alt="image-20220424030407019" style="zoom:50%;" />
<p>限制本模型预测能力的可能原因有：分类精细度和依据不合适；没有找到最关键的自变量；数据采集有偏；模型训练迭代次数不足。</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dong2000.xyz/tags/%E7%8E%AF%E5%A2%83%E7%A7%91%E5%AD%A6/">环境科学</a></li>
      <li><a href="https://dong2000.xyz/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a></li>
      <li><a href="https://dong2000.xyz/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></li>
      <li><a href="https://dong2000.xyz/tags/%E7%88%AC%E8%99%AB/">爬虫</a></li>
      <li><a href="https://dong2000.xyz/tags/python/">Python</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://dong2000.xyz/post/amra_co2/">
    <span class="title">« Prev</span>
    <br>
    <span>自回归滑动平均模型预测全球CO2浓度变化</span>
  </a>
  <a class="next" href="https://dong2000.xyz/post/markdown-mermaid/">
    <span class="title">Next »</span>
    <br>
    <span>Markdown-mermaid画流程图、甘特图和饼图</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022-2025 <a href="https://dong2000.xyz/">Sheng Dong&#39;s website</a></span>
    <span id="busuanzi_container_site_count">
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>.
    
    
        
        &nbsp;&nbsp;本页访问量=<span id="busuanzi_value_page_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body>

</html>
