<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Sci-Hub &#43; Python爬虫实现文献批量下载 | Sheng Dong&#39;s website</title>
<meta name="keywords" content="Python, 爬虫, 文献, Sci-Hub">
<meta name="description" content="


操作思路

在Web of Science或者其他学术搜索引擎上查找所需要的文献，然后将全体检索结果的信息导出成Excel（包括作者、标题、出版年份、期刊、DOI号等等）
以DOI号为检索条件，到Sci-Hub下载文献，将这一过程写成爬虫进行批量处理

导出DOI号序列，写成循环来逐个爬取
以DOI号检索文献，进入下载页面，查找到保存按钮对应的元素，下载到本地
将下载的PDF文件按照自己的标准重命名


手动补全无法在Sci-Hub上得到的文献
">
<meta name="author" content="Sʜᴇɴɢ Dong">
<link rel="canonical" href="https://dong2000.xyz/post/crawl_papers_from_scihub/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.79265b46f66f5bcf04b79589bf3d37013f67d61524773508f9719c7dded6d367.css" integrity="sha256-eSZbRvZvW88Et5WJvz03AT9n1hUkdzUI&#43;XGcfd7W02c=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.4eed01e448f4569cb57e66d5e3d64b94bf981f8fab7d65ef40caf09fc438ace6.js" integrity="sha256-Tu0B5Ej0Vpy1fmbV49ZLlL&#43;YH4&#43;rfWXvQMrwn8Q4rOY="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://dong2000.xyz/ptr.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://dong2000.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dong2000.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dong2000.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://dong2000.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://dong2000.xyz/post/crawl_papers_from_scihub/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MT6FEG7LK4"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-MT6FEG7LK4', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Sci-Hub &#43; Python爬虫实现文献批量下载" />
<meta property="og:description" content="


操作思路

在Web of Science或者其他学术搜索引擎上查找所需要的文献，然后将全体检索结果的信息导出成Excel（包括作者、标题、出版年份、期刊、DOI号等等）
以DOI号为检索条件，到Sci-Hub下载文献，将这一过程写成爬虫进行批量处理

导出DOI号序列，写成循环来逐个爬取
以DOI号检索文献，进入下载页面，查找到保存按钮对应的元素，下载到本地
将下载的PDF文件按照自己的标准重命名


手动补全无法在Sci-Hub上得到的文献
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dong2000.xyz/post/crawl_papers_from_scihub/" /><meta property="og:image" content="https://dong2000.xyz/ptr.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-18T19:27:46+00:00" />
<meta property="article:modified_time" content="2022-05-18T19:27:46+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dong2000.xyz/ptr.png"/>

<meta name="twitter:title" content="Sci-Hub &#43; Python爬虫实现文献批量下载"/>
<meta name="twitter:description" content="


操作思路

在Web of Science或者其他学术搜索引擎上查找所需要的文献，然后将全体检索结果的信息导出成Excel（包括作者、标题、出版年份、期刊、DOI号等等）
以DOI号为检索条件，到Sci-Hub下载文献，将这一过程写成爬虫进行批量处理

导出DOI号序列，写成循环来逐个爬取
以DOI号检索文献，进入下载页面，查找到保存按钮对应的元素，下载到本地
将下载的PDF文件按照自己的标准重命名


手动补全无法在Sci-Hub上得到的文献
"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://dong2000.xyz/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Sci-Hub + Python爬虫实现文献批量下载",
      "item": "https://dong2000.xyz/post/crawl_papers_from_scihub/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Sci-Hub + Python爬虫实现文献批量下载",
  "name": "Sci-Hub \u002b Python爬虫实现文献批量下载",
  "description": "\r操作思路 在Web of Science或者其他学术搜索引擎上查找所需要的文献，然后将全体检索结果的信息导出成Excel（包括作者、标题、出版年份、期刊、DOI号等等） 以DOI号为检索条件，到Sci-Hub下载文献，将这一过程写成爬虫进行批量处理 导出DOI号序列，写成循环来逐个爬取 以DOI号检索文献，进入下载页面，查找到保存按钮对应的元素，下载到本地 将下载的PDF文件按照自己的标准重命名 手动补全无法在Sci-Hub上得到的文献 ",
  "keywords": [
    "Python", "爬虫", "文献", "Sci-Hub"
  ],
  "articleBody": "\r操作思路 在Web of Science或者其他学术搜索引擎上查找所需要的文献，然后将全体检索结果的信息导出成Excel（包括作者、标题、出版年份、期刊、DOI号等等） 以DOI号为检索条件，到Sci-Hub下载文献，将这一过程写成爬虫进行批量处理 导出DOI号序列，写成循环来逐个爬取 以DOI号检索文献，进入下载页面，查找到保存按钮对应的元素，下载到本地 将下载的PDF文件按照自己的标准重命名 手动补全无法在Sci-Hub上得到的文献 注意事项 自动下载覆盖率 这个方法不可能自动获得100%的文献，因为：\nSci-Hub据说对主要出版商的文献覆盖率超过90%，右——这些数据都只是道听途说，总之就是说在批量下载百篇以上文献的时候，肯定会遇到Sci-Hub未收录的情况，实际覆盖率还和学科领域、发表年份、文献语种之类的因素有关（实际操作中发现，Sci-Hub对西班牙语之类的小语种文献覆盖率没有英语文献那么高） Web of Science检索结果不一定包含DOI号（抑或PMID号），这些文章自然也就没无法在Sci-Hub上检索 除了上述硬性的限制，一些文献还可能因为其他原因下载失败：\n网络条件不好，下载时间过长 频繁请求导致本机IP被Sci-Hub给ban了 解决思路如下。\n下载时间过长 打开网页之后，点击save按钮就会自动开始下载PDF文件，通常在几秒内就能完成，但偶尔也会遇到下载特别久的情况（比如网卡了）。但是网页端保持打开的时长是确定的，我经过调整设置成了20秒。也就是说，点击save按钮20秒之后，不管文件有没有下载完成，下载过程都会中断。只下了一半的文件就会破损。在使用Chrome Driver的时候，在下载文件夹里可能会残留一个后缀为.crdownload的临时性文件。\n对于这些临时性文件，可以通过检查文件名后缀的方式来辨别——只有后缀为.pdf的文件，我们才把它视为下载成功的完整文献，并进入到重命名保存的工作；否则就删除文件并标记为下载失败。\n为了减少以上情况出现的概率，需要设置一个足够长的等待时间，具体根据文件大小和网络速度而定。但是也没有必要等得太长，不然也会降低爬虫的运行速度。建议在开始正式运行之前可以先下载两到三个文献尝试一下，然后确定适合的时长。\nIP被Sci-Hub拒绝 因为高频率重复相同的访问和下载请求，Sci-Hub有可能将我判定为机器人（事实上我也确实是一个机器人），并禁止我的IP访问其网站。想到了3个解决办法：\n用sleep()控制爬虫的暂停时间，适当延长两次访问之间的时间间隔。但是这样做的代价就是牺牲爬虫的工作速度，需要做好二者的权衡。我这里设置成了5秒。\n切换访问域名。Sci-Hub本身拥有多个域名，目前有https://sci-hub.ru、https://sci-hub.st、https://sci-hub.se这三个。在每次访问的时候切换到不同的域名。\n如果Ke Xue上网的话，频频被Sci-Hub禁的时候可以换一条线路。（只要我改IP，你就ban不到我）\n这个问题也在提醒我们，频繁用爬虫确实会给网站服务器带来过大的负担。我们在用爬虫给自己省力气的同时也还要体谅体谅网站。更何况是Sci-Hub这种在学术出版商的围堵中坚持为爱发电的伟大工程（呜呜呜不说了，给他们捐钱去了）\n重复运行提高覆盖率 在我的实际操作中，网络条件良好的情况下，第一次全部爬取，得到了60%左右的文献；\n第二次针对缺失的文献爬取，将文献覆盖率提高到了80%左右；\n第三次爬取之后，覆盖率接近90%，可以确定剩下的文献都是Sci-Hub没有收录的，或者在检索的时DOI号就缺失的。对于这些文献，只能写一段代码输出其DOI号或者文章标题，手动补全。\n整体代码 A crawler to do mass downloading based on reference table (from Web of Science) and Sci-Hub database.\n1 2 3 4 5 import pandas as pd from selenium import webdriver import time import os import random 1 2 3 4 5 6 7 8 9 10 11 12 13 table = pd.read_excel('Full record.xlsx',sheet_name='savedrecs') dois = table['DOI'].copy(deep=True) for i in dois.index: dois[i] = str(dois[i]) finished = [0 for i in range(len(dois))] auths = table['Authors'].copy(deep=True) for i in auths.index: name = auths[i].split(';')[0] auths[i] = name.split(',')[0] years = table['Publication Year'] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 def scihub_get(dois, i): chromeOptions = webdriver.ChromeOptions() prefs = {\"download.default_directory\" : \"D:/Chrome Downloads/Articles\"} chromeOptions.add_experimental_option(\"prefs\",prefs) chrome_driver_path = \"D:/Chrome Downloads/chromedriver.exe\" wd = webdriver.Chrome(executable_path=chrome_driver_path) #, options=chromeOptions) scihub = ['https://sci-hub.ru/', 'https://sci-hub.st/', 'https://sci-hub.se/'] root = scihub[random.randint(0,2)] # search by doi doi = dois[i] wd.get(root+doi) time.sleep(1) try: b = wd.find_element_by_xpath('//*[@id=\"buttons\"]/button') b.click() flag = True time.sleep(20) except: print('access failed. index = '+str(i)+' doi = '+doi) flag = False time.sleep(5) wd.quit() return flag 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 def rename_file(dois, finished, auths, years, i): time.sleep(1) path = 'C:/Users/86158/Downloads/' dir_list = os.listdir(path) if len(dir_list)\u003e0: found = 0 for file in dir_list: if file[0:3]!='No_': found = 1 break if found==0: #when didn't get the \"save\" button print('download failed. index = '+str(i)+' doi = '+dois[i]) else: #when we get a new file l = file.split('.') if l[len(l)-1] != \"pdf\": #when the file was half downloaded print('download incomplete. index = '+str(i)+' doi = '+dois[i]) else: old = path+ file auth = str(auths[i]) try: year = str(int(years[i])) except: year = str(years[i]) index = [str(i//100), str((i%100)//10), str(i%10)] new = path+ 'No_' +index[0]+index[1]+index[2]+'_' +auth+'_'+year+'.pdf' os.rename(old, new) finished[i] = 1 1 2 3 4 5 6 7 8 def article_get(dois, finished, auths, years, i): # visit scihub if dois[i]=='nan': print('doi missing. index = '+str(i)) else: if scihub_get(dois, i): # rename rename_file(dois, finished, auths, years, i) 1 2 for i in range(0,3): #len(dois)): article_get(dois, finished, auths, years, i) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # try a new round for missing articles path = 'C:/Users/86158/Downloads/' dir_list = os.listdir(path) for i in range(0,len(dois)): auth = str(auths[i]) try: year = str(int(years[i])) except: year = str(years[i]) index = [str(i//100), str((i%100)//10), str(i%10)] filename = 'No_' +index[0]+index[1]+index[2]+'_' +auth+'_'+year+'.pdf' if filename in dir_list: continue else: article_get(dois, finished, auths, years, i) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # output information of all missing articles path = 'C:/Users/86158/Downloads/' dir_list = os.listdir(path) count = 0 for i in range(0,len(dois)): auth = str(auths[i]) try: year = str(int(years[i])) except: year = str(years[i]) index = [str(i//100), str((i%100)//10), str(i%10)] filename = 'No_' +index[0]+index[1]+index[2]+'_' +auth+'_'+year+'.pdf' if filename in dir_list: continue else: print(filename+\" doi: \"+dois[i]) if dois[i]==\"nan\": print(\" title: \"+table[\"Article Title\"][i]) count+=1 print(str(count)+\" articles missing in total.\") 60% downloaded after first round. Many failures were caused by webserver block. Our IP address may be identified as a robot or DDoS attacker due to regular, frequent visit to the website.\nI used sleep command to lower the visiting frequency, and switched randomly between different sites, as methods to deal with webserver block.\n80% downloaded after second round. Those that remained unfinished were mostly not in the database of sci-hub or lacked DOI numbers.\nHowever, when an article is half downloaded, and the webdriver reached time limit and closed, it is possible that we get a broken file. This means that the file is correctly named, hiding in the group. Yet if we try to open the PDF file it won’t work. At present I don’t know how to do automatic check on these errors. The only solution is longer time period before the webdriver closes, but the whole process will be slower as a sacrifice.x\n",
  "wordCount" : "701",
  "inLanguage": "en",
  "datePublished": "2022-05-18T19:27:46Z",
  "dateModified": "2022-05-18T19:27:46Z",
  "author":{
    "@type": "Person",
    "name": "Sʜᴇɴɢ Dong"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dong2000.xyz/post/crawl_papers_from_scihub/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sheng Dong's website",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dong2000.xyz/ptr.png"
    }
  }
}
</script>




</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dong2000.xyz/" accesskey="h" title="波忒利 (Alt + H)" style="font-size:1.2em;">
                <img src="https://dong2000.xyz/ptr.png" alt="" aria-label="logo"
                    height="40">波忒利</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://dong2000.xyz/profile/" title="Profile"
                            aria-label="Profile">Profile</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://dong2000.xyz/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://dong2000.xyz/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://dong2000.xyz/links/" title="Links">
                    <span>Links</span>
                </a>
            </li>
            <li>
                <a href="https://dong2000.xyz/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header><main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://dong2000.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://dong2000.xyz/post/">Posts</a></div>
    <h1 class="post-title">
      Sci-Hub &#43; Python爬虫实现文献批量下载
    </h1>
    <div class="post-meta">

<span title='2022-05-18 19:27:46 +0000 UTC'>May 18, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Sʜᴇɴɢ Dong&nbsp;·&nbsp;

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details >
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e6%93%8d%e4%bd%9c%e6%80%9d%e8%b7%af" aria-label="操作思路">操作思路</a></li>
                    <li>
                        <a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="注意事项">注意事项</a><ul>
                            
                    <li>
                        <a href="#%e8%87%aa%e5%8a%a8%e4%b8%8b%e8%bd%bd%e8%a6%86%e7%9b%96%e7%8e%87" aria-label="自动下载覆盖率">自动下载覆盖率</a></li>
                    <li>
                        <a href="#%e4%b8%8b%e8%bd%bd%e6%97%b6%e9%97%b4%e8%bf%87%e9%95%bf" aria-label="下载时间过长">下载时间过长</a></li>
                    <li>
                        <a href="#ip%e8%a2%absci-hub%e6%8b%92%e7%bb%9d" aria-label="IP被Sci-Hub拒绝">IP被Sci-Hub拒绝</a></li>
                    <li>
                        <a href="#%e9%87%8d%e5%a4%8d%e8%bf%90%e8%a1%8c%e6%8f%90%e9%ab%98%e8%a6%86%e7%9b%96%e7%8e%87" aria-label="重复运行提高覆盖率">重复运行提高覆盖率</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%95%b4%e4%bd%93%e4%bb%a3%e7%a0%81" aria-label="整体代码">整体代码</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><center>
<img src="/images/image-20220518230710288.png" alt="image-20220518230710288" style="zoom:50%;" />
</center>
<h1 id="操作思路">操作思路<a hidden class="anchor" aria-hidden="true" href="#操作思路">#</a></h1>
<ul>
<li>在Web of Science或者其他学术搜索引擎上查找所需要的文献，然后将全体检索结果的信息导出成Excel（包括作者、标题、出版年份、期刊、DOI号等等）</li>
<li>以DOI号为检索条件，到Sci-Hub下载文献，将这一过程写成爬虫进行批量处理
<ul>
<li>导出DOI号序列，写成循环来逐个爬取</li>
<li>以DOI号检索文献，进入下载页面，查找到保存按钮对应的元素，下载到本地</li>
<li>将下载的PDF文件按照自己的标准重命名</li>
</ul>
</li>
<li>手动补全无法在Sci-Hub上得到的文献</li>
</ul>
<h1 id="注意事项">注意事项<a hidden class="anchor" aria-hidden="true" href="#注意事项">#</a></h1>
<h2 id="自动下载覆盖率">自动下载覆盖率<a hidden class="anchor" aria-hidden="true" href="#自动下载覆盖率">#</a></h2>
<p>这个方法不可能自动获得100%的文献，因为：</p>
<ul>
<li>Sci-Hub据说对主要出版商的文献覆盖率超过90%，右——这些数据都只是道听途说，总之就是说在批量下载百篇以上文献的时候，肯定会遇到Sci-Hub未收录的情况，实际覆盖率还和学科领域、发表年份、文献语种之类的因素有关（实际操作中发现，Sci-Hub对西班牙语之类的小语种文献覆盖率没有英语文献那么高）</li>
<li>Web of Science检索结果不一定包含DOI号（抑或PMID号），这些文章自然也就没无法在Sci-Hub上检索</li>
</ul>
<p>除了上述硬性的限制，一些文献还可能因为其他原因下载失败：</p>
<ul>
<li>网络条件不好，下载时间过长</li>
<li>频繁请求导致本机IP被Sci-Hub给ban了</li>
</ul>
<p>解决思路如下。</p>
<h2 id="下载时间过长">下载时间过长<a hidden class="anchor" aria-hidden="true" href="#下载时间过长">#</a></h2>
<p>打开网页之后，点击<code>save</code>按钮就会自动开始下载PDF文件，通常在几秒内就能完成，但偶尔也会遇到下载特别久的情况（比如网卡了）。但是网页端保持打开的时长是确定的，我经过调整设置成了20秒。也就是说，点击<code>save</code>按钮20秒之后，不管文件有没有下载完成，下载过程都会中断。只下了一半的文件就会破损。在使用Chrome Driver的时候，在下载文件夹里可能会残留一个后缀为<code>.crdownload</code>的临时性文件。</p>
<p>对于这些临时性文件，可以通过检查文件名后缀的方式来辨别——只有后缀为<code>.pdf</code>的文件，我们才把它视为下载成功的完整文献，并进入到重命名保存的工作；否则就删除文件并标记为下载失败。</p>
<p>为了减少以上情况出现的概率，需要设置一个足够长的等待时间，具体根据文件大小和网络速度而定。但是也没有必要等得太长，不然也会降低爬虫的运行速度。建议在开始正式运行之前可以先下载两到三个文献尝试一下，然后确定适合的时长。</p>
<h2 id="ip被sci-hub拒绝">IP被Sci-Hub拒绝<a hidden class="anchor" aria-hidden="true" href="#ip被sci-hub拒绝">#</a></h2>
<p>因为高频率重复相同的访问和下载请求，Sci-Hub有可能将我判定为机器人（事实上我也确实是一个机器人），并禁止我的IP访问其网站。想到了3个解决办法：</p>
<ol>
<li>
<p>用<code>sleep()</code>控制爬虫的暂停时间，适当延长两次访问之间的时间间隔。但是这样做的代价就是牺牲爬虫的工作速度，需要做好二者的权衡。我这里设置成了5秒。</p>
</li>
<li>
<p>切换访问域名。Sci-Hub本身拥有多个域名，目前有<a href="https://sci-hub.ru">https://sci-hub.ru</a>、<a href="https://sci-hub.st">https://sci-hub.st</a>、<a href="https://sci-hub.se">https://sci-hub.se</a>这三个。在每次访问的时候切换到不同的域名。</p>
</li>
<li>
<p>如果Ke Xue上网的话，频频被Sci-Hub禁的时候可以换一条线路。（只要我改IP，你就ban不到我）</p>
</li>
</ol>
<p>这个问题也在提醒我们，频繁用爬虫确实会给网站服务器带来过大的负担。我们在用爬虫给自己省力气的同时也还要体谅体谅网站。更何况是Sci-Hub这种在学术出版商的围堵中坚持为爱发电的伟大工程（呜呜呜不说了，给他们捐钱去了）</p>
<h2 id="重复运行提高覆盖率">重复运行提高覆盖率<a hidden class="anchor" aria-hidden="true" href="#重复运行提高覆盖率">#</a></h2>
<p>在我的实际操作中，网络条件良好的情况下，第一次全部爬取，得到了60%左右的文献；</p>
<p>第二次针对缺失的文献爬取，将文献覆盖率提高到了80%左右；</p>
<p>第三次爬取之后，覆盖率接近90%，可以确定剩下的文献都是Sci-Hub没有收录的，或者在检索的时DOI号就缺失的。对于这些文献，只能写一段代码输出其DOI号或者文章标题，手动补全。</p>
<h1 id="整体代码">整体代码<a hidden class="anchor" aria-hidden="true" href="#整体代码">#</a></h1>
<p>A crawler to do mass downloading based on reference table (from Web of Science) and Sci-Hub database.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a class="lnlinks" href="#hl-0-1">1</a>
</span><span class="lnt" id="hl-0-2"><a class="lnlinks" href="#hl-0-2">2</a>
</span><span class="lnt" id="hl-0-3"><a class="lnlinks" href="#hl-0-3">3</a>
</span><span class="lnt" id="hl-0-4"><a class="lnlinks" href="#hl-0-4">4</a>
</span><span class="lnt" id="hl-0-5"><a class="lnlinks" href="#hl-0-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a class="lnlinks" href="#hl-1-1"> 1</a>
</span><span class="lnt" id="hl-1-2"><a class="lnlinks" href="#hl-1-2"> 2</a>
</span><span class="lnt" id="hl-1-3"><a class="lnlinks" href="#hl-1-3"> 3</a>
</span><span class="lnt" id="hl-1-4"><a class="lnlinks" href="#hl-1-4"> 4</a>
</span><span class="lnt" id="hl-1-5"><a class="lnlinks" href="#hl-1-5"> 5</a>
</span><span class="lnt" id="hl-1-6"><a class="lnlinks" href="#hl-1-6"> 6</a>
</span><span class="lnt" id="hl-1-7"><a class="lnlinks" href="#hl-1-7"> 7</a>
</span><span class="lnt" id="hl-1-8"><a class="lnlinks" href="#hl-1-8"> 8</a>
</span><span class="lnt" id="hl-1-9"><a class="lnlinks" href="#hl-1-9"> 9</a>
</span><span class="lnt" id="hl-1-10"><a class="lnlinks" href="#hl-1-10">10</a>
</span><span class="lnt" id="hl-1-11"><a class="lnlinks" href="#hl-1-11">11</a>
</span><span class="lnt" id="hl-1-12"><a class="lnlinks" href="#hl-1-12">12</a>
</span><span class="lnt" id="hl-1-13"><a class="lnlinks" href="#hl-1-13">13</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;Full record.xlsx&#39;</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;savedrecs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dois</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;DOI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dois</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">finished</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dois</span><span class="p">))]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">auths</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;Authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">auths</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">auths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">auths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">years</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;Publication Year&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-2-1"><a class="lnlinks" href="#hl-2-1"> 1</a>
</span><span class="lnt" id="hl-2-2"><a class="lnlinks" href="#hl-2-2"> 2</a>
</span><span class="lnt" id="hl-2-3"><a class="lnlinks" href="#hl-2-3"> 3</a>
</span><span class="lnt" id="hl-2-4"><a class="lnlinks" href="#hl-2-4"> 4</a>
</span><span class="lnt" id="hl-2-5"><a class="lnlinks" href="#hl-2-5"> 5</a>
</span><span class="lnt" id="hl-2-6"><a class="lnlinks" href="#hl-2-6"> 6</a>
</span><span class="lnt" id="hl-2-7"><a class="lnlinks" href="#hl-2-7"> 7</a>
</span><span class="lnt" id="hl-2-8"><a class="lnlinks" href="#hl-2-8"> 8</a>
</span><span class="lnt" id="hl-2-9"><a class="lnlinks" href="#hl-2-9"> 9</a>
</span><span class="lnt" id="hl-2-10"><a class="lnlinks" href="#hl-2-10">10</a>
</span><span class="lnt" id="hl-2-11"><a class="lnlinks" href="#hl-2-11">11</a>
</span><span class="lnt" id="hl-2-12"><a class="lnlinks" href="#hl-2-12">12</a>
</span><span class="lnt" id="hl-2-13"><a class="lnlinks" href="#hl-2-13">13</a>
</span><span class="lnt" id="hl-2-14"><a class="lnlinks" href="#hl-2-14">14</a>
</span><span class="lnt" id="hl-2-15"><a class="lnlinks" href="#hl-2-15">15</a>
</span><span class="lnt" id="hl-2-16"><a class="lnlinks" href="#hl-2-16">16</a>
</span><span class="lnt" id="hl-2-17"><a class="lnlinks" href="#hl-2-17">17</a>
</span><span class="lnt" id="hl-2-18"><a class="lnlinks" href="#hl-2-18">18</a>
</span><span class="lnt" id="hl-2-19"><a class="lnlinks" href="#hl-2-19">19</a>
</span><span class="lnt" id="hl-2-20"><a class="lnlinks" href="#hl-2-20">20</a>
</span><span class="lnt" id="hl-2-21"><a class="lnlinks" href="#hl-2-21">21</a>
</span><span class="lnt" id="hl-2-22"><a class="lnlinks" href="#hl-2-22">22</a>
</span><span class="lnt" id="hl-2-23"><a class="lnlinks" href="#hl-2-23">23</a>
</span><span class="lnt" id="hl-2-24"><a class="lnlinks" href="#hl-2-24">24</a>
</span><span class="lnt" id="hl-2-25"><a class="lnlinks" href="#hl-2-25">25</a>
</span><span class="lnt" id="hl-2-26"><a class="lnlinks" href="#hl-2-26">26</a>
</span><span class="lnt" id="hl-2-27"><a class="lnlinks" href="#hl-2-27">27</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">scihub_get</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">chromeOptions</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">prefs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;download.default_directory&#34;</span> <span class="p">:</span> <span class="s2">&#34;D:/Chrome Downloads/Articles&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">chromeOptions</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&#34;prefs&#34;</span><span class="p">,</span><span class="n">prefs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">chrome_driver_path</span> <span class="o">=</span> <span class="s2">&#34;D:/Chrome Downloads/chromedriver.exe&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">wd</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">chrome_driver_path</span><span class="p">)</span> <span class="c1">#, options=chromeOptions)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">scihub</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://sci-hub.ru/&#39;</span><span class="p">,</span> <span class="s1">&#39;https://sci-hub.st/&#39;</span><span class="p">,</span> <span class="s1">&#39;https://sci-hub.se/&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">root</span> <span class="o">=</span> <span class="n">scihub</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># search by doi</span>
</span></span><span class="line"><span class="cl">    <span class="n">doi</span> <span class="o">=</span> <span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">wd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">root</span><span class="o">+</span><span class="n">doi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&#34;buttons&#34;]/button&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;access failed.    index = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;    doi = &#39;</span><span class="o">+</span><span class="n">doi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">wd</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">flag</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-3-1"><a class="lnlinks" href="#hl-3-1"> 1</a>
</span><span class="lnt" id="hl-3-2"><a class="lnlinks" href="#hl-3-2"> 2</a>
</span><span class="lnt" id="hl-3-3"><a class="lnlinks" href="#hl-3-3"> 3</a>
</span><span class="lnt" id="hl-3-4"><a class="lnlinks" href="#hl-3-4"> 4</a>
</span><span class="lnt" id="hl-3-5"><a class="lnlinks" href="#hl-3-5"> 5</a>
</span><span class="lnt" id="hl-3-6"><a class="lnlinks" href="#hl-3-6"> 6</a>
</span><span class="lnt" id="hl-3-7"><a class="lnlinks" href="#hl-3-7"> 7</a>
</span><span class="lnt" id="hl-3-8"><a class="lnlinks" href="#hl-3-8"> 8</a>
</span><span class="lnt" id="hl-3-9"><a class="lnlinks" href="#hl-3-9"> 9</a>
</span><span class="lnt" id="hl-3-10"><a class="lnlinks" href="#hl-3-10">10</a>
</span><span class="lnt" id="hl-3-11"><a class="lnlinks" href="#hl-3-11">11</a>
</span><span class="lnt" id="hl-3-12"><a class="lnlinks" href="#hl-3-12">12</a>
</span><span class="lnt" id="hl-3-13"><a class="lnlinks" href="#hl-3-13">13</a>
</span><span class="lnt" id="hl-3-14"><a class="lnlinks" href="#hl-3-14">14</a>
</span><span class="lnt" id="hl-3-15"><a class="lnlinks" href="#hl-3-15">15</a>
</span><span class="lnt" id="hl-3-16"><a class="lnlinks" href="#hl-3-16">16</a>
</span><span class="lnt" id="hl-3-17"><a class="lnlinks" href="#hl-3-17">17</a>
</span><span class="lnt" id="hl-3-18"><a class="lnlinks" href="#hl-3-18">18</a>
</span><span class="lnt" id="hl-3-19"><a class="lnlinks" href="#hl-3-19">19</a>
</span><span class="lnt" id="hl-3-20"><a class="lnlinks" href="#hl-3-20">20</a>
</span><span class="lnt" id="hl-3-21"><a class="lnlinks" href="#hl-3-21">21</a>
</span><span class="lnt" id="hl-3-22"><a class="lnlinks" href="#hl-3-22">22</a>
</span><span class="lnt" id="hl-3-23"><a class="lnlinks" href="#hl-3-23">23</a>
</span><span class="lnt" id="hl-3-24"><a class="lnlinks" href="#hl-3-24">24</a>
</span><span class="lnt" id="hl-3-25"><a class="lnlinks" href="#hl-3-25">25</a>
</span><span class="lnt" id="hl-3-26"><a class="lnlinks" href="#hl-3-26">26</a>
</span><span class="lnt" id="hl-3-27"><a class="lnlinks" href="#hl-3-27">27</a>
</span><span class="lnt" id="hl-3-28"><a class="lnlinks" href="#hl-3-28">28</a>
</span><span class="lnt" id="hl-3-29"><a class="lnlinks" href="#hl-3-29">29</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rename_file</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/86158/Downloads/&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">dir_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dir_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;No_&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">found</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1">#when didn&#39;t get the &#34;save&#34; button</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;download failed.    index = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;    doi = &#39;</span><span class="o">+</span><span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span> <span class="c1">#when we get a new file</span>
</span></span><span class="line"><span class="cl">            <span class="n">l</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&#34;pdf&#34;</span><span class="p">:</span> <span class="c1">#when the file was half downloaded</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;download incomplete.    index = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;    doi = &#39;</span><span class="o">+</span><span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">old</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span> <span class="n">file</span>
</span></span><span class="line"><span class="cl">                <span class="n">auth</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">auths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="mi">100</span><span class="p">),</span> <span class="nb">str</span><span class="p">((</span><span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="p">)</span><span class="o">//</span><span class="mi">10</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">10</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                <span class="n">new</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span> <span class="s1">&#39;No_&#39;</span> <span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="n">auth</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">finished</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-4-1"><a class="lnlinks" href="#hl-4-1">1</a>
</span><span class="lnt" id="hl-4-2"><a class="lnlinks" href="#hl-4-2">2</a>
</span><span class="lnt" id="hl-4-3"><a class="lnlinks" href="#hl-4-3">3</a>
</span><span class="lnt" id="hl-4-4"><a class="lnlinks" href="#hl-4-4">4</a>
</span><span class="lnt" id="hl-4-5"><a class="lnlinks" href="#hl-4-5">5</a>
</span><span class="lnt" id="hl-4-6"><a class="lnlinks" href="#hl-4-6">6</a>
</span><span class="lnt" id="hl-4-7"><a class="lnlinks" href="#hl-4-7">7</a>
</span><span class="lnt" id="hl-4-8"><a class="lnlinks" href="#hl-4-8">8</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">article_get</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># visit scihub</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nan&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;doi missing.    index = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">scihub_get</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># rename</span>
</span></span><span class="line"><span class="cl">            <span class="n">rename_file</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-5-1"><a class="lnlinks" href="#hl-5-1">1</a>
</span><span class="lnt" id="hl-5-2"><a class="lnlinks" href="#hl-5-2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span> <span class="c1">#len(dois)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">article_get</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-6-1"><a class="lnlinks" href="#hl-6-1"> 1</a>
</span><span class="lnt" id="hl-6-2"><a class="lnlinks" href="#hl-6-2"> 2</a>
</span><span class="lnt" id="hl-6-3"><a class="lnlinks" href="#hl-6-3"> 3</a>
</span><span class="lnt" id="hl-6-4"><a class="lnlinks" href="#hl-6-4"> 4</a>
</span><span class="lnt" id="hl-6-5"><a class="lnlinks" href="#hl-6-5"> 5</a>
</span><span class="lnt" id="hl-6-6"><a class="lnlinks" href="#hl-6-6"> 6</a>
</span><span class="lnt" id="hl-6-7"><a class="lnlinks" href="#hl-6-7"> 7</a>
</span><span class="lnt" id="hl-6-8"><a class="lnlinks" href="#hl-6-8"> 8</a>
</span><span class="lnt" id="hl-6-9"><a class="lnlinks" href="#hl-6-9"> 9</a>
</span><span class="lnt" id="hl-6-10"><a class="lnlinks" href="#hl-6-10">10</a>
</span><span class="lnt" id="hl-6-11"><a class="lnlinks" href="#hl-6-11">11</a>
</span><span class="lnt" id="hl-6-12"><a class="lnlinks" href="#hl-6-12">12</a>
</span><span class="lnt" id="hl-6-13"><a class="lnlinks" href="#hl-6-13">13</a>
</span><span class="lnt" id="hl-6-14"><a class="lnlinks" href="#hl-6-14">14</a>
</span><span class="lnt" id="hl-6-15"><a class="lnlinks" href="#hl-6-15">15</a>
</span><span class="lnt" id="hl-6-16"><a class="lnlinks" href="#hl-6-16">16</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># try a new round for missing articles</span>
</span></span><span class="line"><span class="cl"><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/86158/Downloads/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">dir_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dois</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">auths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="mi">100</span><span class="p">),</span> <span class="nb">str</span><span class="p">((</span><span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="p">)</span><span class="o">//</span><span class="mi">10</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">10</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;No_&#39;</span> <span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="n">auth</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>    
</span></span><span class="line"><span class="cl">        <span class="n">article_get</span><span class="p">(</span><span class="n">dois</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-7-1"><a class="lnlinks" href="#hl-7-1"> 1</a>
</span><span class="lnt" id="hl-7-2"><a class="lnlinks" href="#hl-7-2"> 2</a>
</span><span class="lnt" id="hl-7-3"><a class="lnlinks" href="#hl-7-3"> 3</a>
</span><span class="lnt" id="hl-7-4"><a class="lnlinks" href="#hl-7-4"> 4</a>
</span><span class="lnt" id="hl-7-5"><a class="lnlinks" href="#hl-7-5"> 5</a>
</span><span class="lnt" id="hl-7-6"><a class="lnlinks" href="#hl-7-6"> 6</a>
</span><span class="lnt" id="hl-7-7"><a class="lnlinks" href="#hl-7-7"> 7</a>
</span><span class="lnt" id="hl-7-8"><a class="lnlinks" href="#hl-7-8"> 8</a>
</span><span class="lnt" id="hl-7-9"><a class="lnlinks" href="#hl-7-9"> 9</a>
</span><span class="lnt" id="hl-7-10"><a class="lnlinks" href="#hl-7-10">10</a>
</span><span class="lnt" id="hl-7-11"><a class="lnlinks" href="#hl-7-11">11</a>
</span><span class="lnt" id="hl-7-12"><a class="lnlinks" href="#hl-7-12">12</a>
</span><span class="lnt" id="hl-7-13"><a class="lnlinks" href="#hl-7-13">13</a>
</span><span class="lnt" id="hl-7-14"><a class="lnlinks" href="#hl-7-14">14</a>
</span><span class="lnt" id="hl-7-15"><a class="lnlinks" href="#hl-7-15">15</a>
</span><span class="lnt" id="hl-7-16"><a class="lnlinks" href="#hl-7-16">16</a>
</span><span class="lnt" id="hl-7-17"><a class="lnlinks" href="#hl-7-17">17</a>
</span><span class="lnt" id="hl-7-18"><a class="lnlinks" href="#hl-7-18">18</a>
</span><span class="lnt" id="hl-7-19"><a class="lnlinks" href="#hl-7-19">19</a>
</span><span class="lnt" id="hl-7-20"><a class="lnlinks" href="#hl-7-20">20</a>
</span><span class="lnt" id="hl-7-21"><a class="lnlinks" href="#hl-7-21">21</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># output information of all missing articles</span>
</span></span><span class="line"><span class="cl"><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/86158/Downloads/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">dir_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dois</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">auths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="mi">100</span><span class="p">),</span> <span class="nb">str</span><span class="p">((</span><span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="p">)</span><span class="o">//</span><span class="mi">10</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">10</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;No_&#39;</span> <span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="n">auth</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>    
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s2">&#34;    doi: &#34;</span><span class="o">+</span><span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">dois</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s2">&#34;nan&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;    title: &#34;</span><span class="o">+</span><span class="n">table</span><span class="p">[</span><span class="s2">&#34;Article Title&#34;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34; articles missing in total.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>60% downloaded after first round. Many failures were caused by webserver block. Our IP address may be identified as a robot or DDoS attacker due to regular, frequent visit to the website.</p>
<p>I used sleep command to lower the visiting frequency, and switched randomly between different sites, as methods to deal with webserver block.</p>
<p>80% downloaded after second round. Those that remained unfinished were mostly not in the database of sci-hub or lacked DOI numbers.</p>
<p>However, when an article is half downloaded, and the webdriver reached time limit and closed, it is possible that we get a broken file. This means that the file is correctly named, hiding in the group. Yet if we try to open the PDF file it won&rsquo;t work. At present I don&rsquo;t know how to do automatic check on these errors. The only solution is longer time period before the webdriver closes, but the whole process will be slower as a sacrifice.x</p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dong2000.xyz/tags/python/">Python</a></li>
      <li><a href="https://dong2000.xyz/tags/%E7%88%AC%E8%99%AB/">爬虫</a></li>
      <li><a href="https://dong2000.xyz/tags/%E6%96%87%E7%8C%AE/">文献</a></li>
      <li><a href="https://dong2000.xyz/tags/sci-hub/">Sci-Hub</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://dong2000.xyz/post/system_sci_review/">
    <span class="title">« Prev</span>
    <br>
    <span>系统科学与工程复习整理</span>
  </a>
  <a class="next" href="https://dong2000.xyz/post/on_icm_2022/">
    <span class="title">Next »</span>
    <br>
    <span>2022美赛纪念</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022-2025 <a href="https://dong2000.xyz/">Sheng Dong&#39;s website</a></span>
    <span id="busuanzi_container_site_count">
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>.
    
    
        
        &nbsp;&nbsp;本页访问量=<span id="busuanzi_value_page_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body>

</html>
